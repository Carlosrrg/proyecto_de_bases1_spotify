window.addEventListener||(Window.prototype.addEventListener=function(e,h){return this.attachEvent("on"+e,h)});var KeyValueStore=function(){this.cache={}};KeyValueStore.prototype.set=function(e,h){this.cache[e]=h};KeyValueStore.prototype.get=function(e){return this.cache.hasOwnProperty(e)?this.cache[e]:null};
(function(e,h){function m(a,b,d){null!=a&&("number"==typeof a?this.fromNumber(a,b,d):null==b&&"string"!=typeof a?this.fromString(a,256):this.fromString(a,b))}function q(){return new m(null)}function t(a,b,d,k,c,f){for(;0<=--f;){var g=b*this[a++]+d[k]+c;c=Math.floor(g/67108864);d[k++]=g&67108863}return c}function C(a,b,d,k,c,f){var g=b&32767;for(b>>=15;0<=--f;){var K=this[a]&32767,e=this[a++]>>15,h=b*K+e*g,K=g*K+((h&32767)<<15)+d[k]+(c&1073741823);c=(K>>>30)+(h>>>15)+b*e+(c>>>30);d[k++]=K&1073741823}return c}
function I(a,b,d,k,c,f){var g=b&16383;for(b>>=14;0<=--f;){var K=this[a]&16383,e=this[a++]>>14,h=b*K+e*g,K=g*K+((h&16383)<<14)+d[k]+c;c=(K>>28)+(h>>14)+b*e;d[k++]=K&268435455}return c}function G(a){var b=q();b.fromInt(a);return b}function H(a){var b=1,d;0!=(d=a>>>16)&&(a=d,b+=16);0!=(d=a>>8)&&(a=d,b+=8);0!=(d=a>>4)&&(a=d,b+=4);0!=(d=a>>2)&&(a=d,b+=2);0!=a>>1&&(b+=1);return b}function E(a){this.m=a}function J(a){this.m=a;this.mp=a.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<a.DB-
15)-1;this.mt2=2*a.t}function S(){this.j=this.i=0;this.S=[]}function T(a){y[u++]^=a&255;y[u++]^=a>>8&255;y[u++]^=a>>16&255;y[u++]^=a>>24&255;256<=u&&(u-=256)}function x(){}function M(){this.n=null;this.e=0;this.coeff=this.dmq1=this.dmp1=this.q=this.p=this.d=null}function w(a){throw a;}function ba(a,b,d){4!==b.length&&w(new p.exception.invalid("invalid aes block size"));var k=a.b[d],c=b[0]^k[0],f=b[d?3:1]^k[1],g=b[2]^k[2];b=b[d?1:3]^k[3];var e,h,n,m=k.length/4-2,F,q=4,r=[0,0,0,0];e=a.k[d];a=e[0];var ea=
e[1],s=e[2],t=e[3],u=e[4];for(F=0;F<m;F++)e=a[c>>>24]^ea[f>>16&255]^s[g>>8&255]^t[b&255]^k[q],h=a[f>>>24]^ea[g>>16&255]^s[b>>8&255]^t[c&255]^k[q+1],n=a[g>>>24]^ea[b>>16&255]^s[c>>8&255]^t[f&255]^k[q+2],b=a[b>>>24]^ea[c>>16&255]^s[f>>8&255]^t[g&255]^k[q+3],q+=4,c=e,f=h,g=n;for(F=0;4>F;F++)r[d?3&-F:F]=u[c>>>24]<<24^u[f>>16&255]<<16^u[g>>8&255]<<8^u[b&255]^k[q++],e=c,c=f,f=g,g=b,b=e;return r}function N(a,b){var d,k,c,f=b.slice(0),g=a.r,e=a.b,h=g[0],n=g[1],p=g[2],m=g[3],q=g[4],r=g[5],s=g[6],t=g[7];for(d=
0;64>d;d++)16>d?k=f[d]:(k=f[d+1&15],c=f[d+14&15],k=f[d&15]=(k>>>7^k>>>18^k>>>3^k<<25^k<<14)+(c>>>17^c>>>19^c>>>10^c<<15^c<<13)+f[d&15]+f[d+9&15]|0),k=k+t+(q>>>6^q>>>11^q>>>25^q<<26^q<<21^q<<7)+(s^q&(r^s))+e[d],t=s,s=r,r=q,q=m+k|0,m=p,p=n,n=h,h=k+(n&p^m&(n^p))+(n>>>2^n>>>13^n>>>22^n<<30^n<<19^n<<10)|0;g[0]=g[0]+h|0;g[1]=g[1]+n|0;g[2]=g[2]+p|0;g[3]=g[3]+m|0;g[4]=g[4]+q|0;g[5]=g[5]+r|0;g[6]=g[6]+s|0;g[7]=g[7]+t|0}function ca(a,b){var d,k=p.random.w[a],c=[];for(d in k)k.hasOwnProperty(d)&&c.push(k[d]);
for(d=0;d<c.length;d++)c[d](b)}function U(a){"undefined"!==typeof window&&window.performance&&"function"===typeof window.performance.now?p.random.addEntropy(window.performance.now(),a,"loadtime"):p.random.addEntropy((new Date).valueOf(),a,"loadtime")}function Y(a){a.b=P(a).concat(P(a));a.A=new p.cipher.aes(a.b)}function P(a){for(var b=0;4>b&&(a.f[b]=a.f[b]+1|0,!a.f[b]);b++);return a.A.encrypt(a.f)}function aa(a,b){return function(){b.apply(a,arguments)}}(function(){function a(a,b){return this.slice(a,
b)}function b(a,b){2>arguments.length&&(b=0);for(var d=0,k=a.length;d<k;++d,++b)this[b]=a[d]&255}function d(d){var k;if("number"===typeof d){k=Array(d);for(var c=0;c<d;++c)k[c]=0}else k=d.slice(0);k.subarray=a;k.buffer=k;k.byteLength=k.length;k.set=b;"object"===typeof d&&d.buffer&&(k.buffer=d.buffer);return k}try{new Uint8Array(1);new Uint32Array(1);new Int32Array(1);return}catch(k){}try{window.Uint8Array=d}catch(c){}try{window.Uint32Array=d}catch(f){}try{window.Int32Array=d}catch(g){}})();(function(){try{"undefined"===
typeof window||"btoa"in window||(window.btoa=function(a){var d="",k,c;k=0;for(c=a.length;k<c;k+=3)var f=a.charCodeAt(k)&255,g=a.charCodeAt(k+1)&255,e=a.charCodeAt(k+2)&255,h=(f&3)<<4|g>>4,g=k+1<c?(g&15)<<2|e>>6:64,e=k+2<c?e&63:64,d=d+("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(f>>2)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(e));
return d})}catch(a){}})();var z;"Microsoft Internet Explorer"==navigator.appName?(m.prototype.am=C,z=30):"Netscape"!=navigator.appName?(m.prototype.am=t,z=26):(m.prototype.am=I,z=28);m.prototype.DB=z;m.prototype.DM=(1<<z)-1;m.prototype.DV=1<<z;m.prototype.FV=Math.pow(2,52);m.prototype.F1=52-z;m.prototype.F2=2*z-52;var Q=[],A;z=48;for(A=0;9>=A;++A)Q[z++]=A;z=97;for(A=10;36>A;++A)Q[z++]=A;z=65;for(A=10;36>A;++A)Q[z++]=A;E.prototype.convert=function(a){return 0>a.s||0<=a.compareTo(this.m)?a.mod(this.m):
a};E.prototype.revert=function(a){return a};E.prototype.reduce=function(a){a.divRemTo(this.m,null,a)};E.prototype.mulTo=function(a,b,d){a.multiplyTo(b,d);this.reduce(d)};E.prototype.sqrTo=function(a,b){a.squareTo(b);this.reduce(b)};J.prototype.convert=function(a){var b=q();a.abs().dlShiftTo(this.m.t,b);b.divRemTo(this.m,null,b);0>a.s&&0<b.compareTo(m.ZERO)&&this.m.subTo(b,b);return b};J.prototype.revert=function(a){var b=q();a.copyTo(b);this.reduce(b);return b};J.prototype.reduce=function(a){for(;a.t<=
this.mt2;)a[a.t++]=0;for(var b=0;b<this.m.t;++b){var d=a[b]&32767,k=d*this.mpl+((d*this.mph+(a[b]>>15)*this.mpl&this.um)<<15)&a.DM,d=b+this.m.t;for(a[d]+=this.m.am(0,k,a,b,0,this.m.t);a[d]>=a.DV;)a[d]-=a.DV,a[++d]++}a.clamp();a.drShiftTo(this.m.t,a);0<=a.compareTo(this.m)&&a.subTo(this.m,a)};J.prototype.mulTo=function(a,b,d){a.multiplyTo(b,d);this.reduce(d)};J.prototype.sqrTo=function(a,b){a.squareTo(b);this.reduce(b)};m.prototype.copyTo=function(a){for(var b=this.t-1;0<=b;--b)a[b]=this[b];a.t=this.t;
a.s=this.s};m.prototype.fromInt=function(a){this.t=1;this.s=0>a?-1:0;0<a?this[0]=a:-1>a?this[0]=a+this.DV:this.t=0};m.prototype.fromString=function(a,b){var d;if(16==b)d=4;else if(8==b)d=3;else if(256==b)d=8;else if(2==b)d=1;else if(32==b)d=5;else if(4==b)d=2;else{this.fromRadix(a,b);return}this.s=this.t=0;for(var k=a.length,c=!1,f=0;0<=--k;){var g;8==d?g=a[k]&255:(g=Q[a.charCodeAt(k)],g=null==g?-1:g);0>g?"-"==a.charAt(k)&&(c=!0):(c=!1,0==f?this[this.t++]=g:f+d>this.DB?(this[this.t-1]|=(g&(1<<this.DB-
f)-1)<<f,this[this.t++]=g>>this.DB-f):this[this.t-1]|=g<<f,f+=d,f>=this.DB&&(f-=this.DB))}8==d&&0!=(a[0]&128)&&(this.s=-1,0<f&&(this[this.t-1]|=(1<<this.DB-f)-1<<f));this.clamp();c&&m.ZERO.subTo(this,this)};m.prototype.clamp=function(){for(var a=this.s&this.DM;0<this.t&&this[this.t-1]==a;)--this.t};m.prototype.dlShiftTo=function(a,b){var d;for(d=this.t-1;0<=d;--d)b[d+a]=this[d];for(d=a-1;0<=d;--d)b[d]=0;b.t=this.t+a;b.s=this.s};m.prototype.drShiftTo=function(a,b){for(var d=a;d<this.t;++d)b[d-a]=this[d];
b.t=Math.max(this.t-a,0);b.s=this.s};m.prototype.lShiftTo=function(a,b){var d=a%this.DB,k=this.DB-d,c=(1<<k)-1,f=Math.floor(a/this.DB),g=this.s<<d&this.DM,e;for(e=this.t-1;0<=e;--e)b[e+f+1]=this[e]>>k|g,g=(this[e]&c)<<d;for(e=f-1;0<=e;--e)b[e]=0;b[f]=g;b.t=this.t+f+1;b.s=this.s;b.clamp()};m.prototype.rShiftTo=function(a,b){b.s=this.s;var d=Math.floor(a/this.DB);if(d>=this.t)b.t=0;else{var k=a%this.DB,c=this.DB-k,f=(1<<k)-1;b[0]=this[d]>>k;for(var g=d+1;g<this.t;++g)b[g-d-1]|=(this[g]&f)<<c,b[g-d]=
this[g]>>k;0<k&&(b[this.t-d-1]|=(this.s&f)<<c);b.t=this.t-d;b.clamp()}};m.prototype.subTo=function(a,b){for(var d=0,k=0,c=Math.min(a.t,this.t);d<c;)k+=this[d]-a[d],b[d++]=k&this.DM,k>>=this.DB;if(a.t<this.t){for(k-=a.s;d<this.t;)k+=this[d],b[d++]=k&this.DM,k>>=this.DB;k+=this.s}else{for(k+=this.s;d<a.t;)k-=a[d],b[d++]=k&this.DM,k>>=this.DB;k-=a.s}b.s=0>k?-1:0;-1>k?b[d++]=this.DV+k:0<k&&(b[d++]=k);b.t=d;b.clamp()};m.prototype.multiplyTo=function(a,b){var d=this.abs(),k=a.abs(),c=d.t;for(b.t=c+k.t;0<=
--c;)b[c]=0;for(c=0;c<k.t;++c)b[c+d.t]=d.am(0,k[c],b,c,0,d.t);b.s=0;b.clamp();this.s!=a.s&&m.ZERO.subTo(b,b)};m.prototype.squareTo=function(a){for(var b=this.abs(),d=a.t=2*b.t;0<=--d;)a[d]=0;for(d=0;d<b.t-1;++d){var k=b.am(d,b[d],a,2*d,0,1);(a[d+b.t]+=b.am(d+1,2*b[d],a,2*d+1,k,b.t-d-1))>=b.DV&&(a[d+b.t]-=b.DV,a[d+b.t+1]=1)}0<a.t&&(a[a.t-1]+=b.am(d,b[d],a,2*d,0,1));a.s=0;a.clamp()};m.prototype.divRemTo=function(a,b,d){var k=a.abs();if(!(0>=k.t)){var c=this.abs();if(c.t<k.t)null!=b&&b.fromInt(0),null!=
d&&this.copyTo(d);else{null==d&&(d=q());var f=q(),g=this.s;a=a.s;var e=this.DB-H(k[k.t-1]);0<e?(k.lShiftTo(e,f),c.lShiftTo(e,d)):(k.copyTo(f),c.copyTo(d));k=f.t;c=f[k-1];if(0!=c){var h=c*(1<<this.F1)+(1<k?f[k-2]>>this.F2:0),n=this.FV/h,h=(1<<this.F1)/h,p=1<<this.F2,F=d.t,da=F-k,r=null==b?q():b;f.dlShiftTo(da,r);0<=d.compareTo(r)&&(d[d.t++]=1,d.subTo(r,d));m.ONE.dlShiftTo(k,r);for(r.subTo(f,f);f.t<k;)f[f.t++]=0;for(;0<=--da;){var s=d[--F]==c?this.DM:Math.floor(d[F]*n+(d[F-1]+p)*h);if((d[F]+=f.am(0,
s,d,da,0,k))<s)for(f.dlShiftTo(da,r),d.subTo(r,d);d[F]<--s;)d.subTo(r,d)}null!=b&&(d.drShiftTo(k,b),g!=a&&m.ZERO.subTo(b,b));d.t=k;d.clamp();0<e&&d.rShiftTo(e,d);0>g&&m.ZERO.subTo(d,d)}}}};m.prototype.invDigit=function(){if(1>this.t)return 0;var a=this[0];if(0==(a&1))return 0;var b=a&3,b=b*(2-(a&15)*b)&15,b=b*(2-(a&255)*b)&255,b=b*(2-((a&65535)*b&65535))&65535,b=b*(2-a*b%this.DV)%this.DV;return 0<b?this.DV-b:-b};m.prototype.isEven=function(){return 0==(0<this.t?this[0]&1:this.s)};m.prototype.exp=
function(a,b){if(4294967295<a||1>a)return m.ONE;var d=q(),k=q(),c=b.convert(this),f=H(a)-1;for(c.copyTo(d);0<=--f;)if(b.sqrTo(d,k),0<(a&1<<f))b.mulTo(k,c,d);else var g=d,d=k,k=g;return b.revert(d)};m.prototype.toString=function(a){if(0>this.s)return"-"+this.negate().toString(a);if(16==a)a=4;else if(8==a)a=3;else if(2==a)a=1;else if(32==a)a=5;else if(4==a)a=2;else return this.toRadix(a);var b=(1<<a)-1,d,k=!1,c="",f=this.t,g=this.DB-f*this.DB%a;if(0<f--)for(g<this.DB&&0<(d=this[f]>>g)&&(k=!0,c="0123456789abcdefghijklmnopqrstuvwxyz".charAt(d));0<=
f;)g<a?(d=(this[f]&(1<<g)-1)<<a-g,d|=this[--f]>>(g+=this.DB-a)):(d=this[f]>>(g-=a)&b,0>=g&&(g+=this.DB,--f)),0<d&&(k=!0),k&&(c+="0123456789abcdefghijklmnopqrstuvwxyz".charAt(d));return k?c:"0"};m.prototype.negate=function(){var a=q();m.ZERO.subTo(this,a);return a};m.prototype.abs=function(){return 0>this.s?this.negate():this};m.prototype.compareTo=function(a){var b=this.s-a.s;if(0!=b)return b;var d=this.t,b=d-a.t;if(0!=b)return 0>this.s?-b:b;for(;0<=--d;)if(0!=(b=this[d]-a[d]))return b;return 0};
m.prototype.bitLength=function(){return 0>=this.t?0:this.DB*(this.t-1)+H(this[this.t-1]^this.s&this.DM)};m.prototype.mod=function(a){var b=q();this.abs().divRemTo(a,null,b);0>this.s&&0<b.compareTo(m.ZERO)&&a.subTo(b,b);return b};m.prototype.modPowInt=function(a,b){var d;d=256>a||b.isEven()?new E(b):new J(b);return this.exp(a,d)};m.ZERO=G(0);m.ONE=G(1);S.prototype.init=function(a){var b,d,k;for(b=0;256>b;++b)this.S[b]=b;for(b=d=0;256>b;++b)d=d+this.S[b]+a[b%a.length]&255,k=this.S[b],this.S[b]=this.S[d],
this.S[d]=k;this.j=this.i=0};S.prototype.next=function(){var a;this.i=this.i+1&255;this.j=this.j+this.S[this.i]&255;a=this.S[this.i];this.S[this.i]=this.S[this.j];this.S[this.j]=a;return this.S[a+this.S[this.i]&255]};var R,y,u;if(null==y){y=[];u=0;var r;try{if(window.crypto&&window.crypto.getRandomValues){var D=new Uint8Array(32);window.crypto.getRandomValues(D);for(r=0;32>r;++r)y[u++]=D[r]}else if(window.msCrypto&&window.msCrypto.getRandomValues)for(D=new Uint8Array(32),window.msCrypto.getRandomValues(D),
r=0;32>r;++r)y[u++]=D[r];else if(window.crypto&&window.crypto.random)for(N=window.crypto.random(32),r=0;r<N.length;++r)y[u++]=N.charCodeAt(r)&255}catch(ia){}for(;256>u;)r=Math.floor(65536*Math.random()),y[u++]=r>>>8,y[u++]=r&255;u=0;T((new Date).getTime())}x.prototype.nextBytes=function(a){var b;for(b=0;b<a.length;++b){var d=b,k;if(null==R){T((new Date).getTime());R=new S;R.init(y);for(u=0;u<y.length;++u)y[u]=0;u=0}k=R.next();a[d]=k}};M.prototype.doPublic=function(a){return a.modPowInt(this.e,this.n)};
M.prototype.setPublic=function(a,b){null!=a&&null!=b&&0<a.length&&0<b.length?(this.n=new m(a,16),this.e=parseInt(b,16)):alert("Invalid RSA public key")};M.prototype.encrypt=function(a){var b;b=this.n.bitLength()+7>>3;if(b<a.length+11)alert("Message too long for RSA"),b=null;else{for(var d=[],k=a.length-1;0<=k&&0<b;)d[--b]=a[k--];d[--b]=0;a=new x;for(k=[];2<b;){for(k[0]=0;0==k[0];)a.nextBytes(k);d[--b]=k[0]}d[--b]=2;d[--b]=0;b=new m(d)}if(null==b)return null;b=this.doPublic(b);if(null==b)return null;
b=b.toString(16);return 0==(b.length&1)?b:"0"+b};M.prototype.encrypt_b64=function(a){if(a=this.encrypt(a)){var b,d,k="";for(b=0;b+3<=a.length;b+=3)d=parseInt(a.substring(b,b+3),16),k+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d>>6)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d&63);b+1==a.length?(d=parseInt(a.substring(b,b+1),16),k+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d<<2)):b+2==a.length&&(d=parseInt(a.substring(b,
b+2),16),k+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d>>2)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((d&3)<<4));for(;0<(k.length&3);)k+="\x3d";return k}return null};"use strict";r=void 0;var p={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(a){this.toString=function(){return"CORRUPT: "+this.message};this.message=a},invalid:function(a){this.toString=function(){return"INVALID: "+this.message};this.message=
a},bug:function(a){this.toString=function(){return"BUG: "+this.message};this.message=a},notReady:function(a){this.toString=function(){return"NOT READY: "+this.message};this.message=a}}};"undefined"!==typeof module&&module.exports&&(module.exports=p);p.cipher.aes=function(a){this.k[0][0][0]||this.D();var b,d,k,c,f=this.k[0][4],g=this.k[1];b=a.length;var e=1;4!==b&&6!==b&&8!==b&&w(new p.exception.invalid("invalid aes key size"));this.b=[k=a.slice(0),c=[]];for(a=b;a<4*b+28;a++){d=k[a-1];if(0===a%b||
8===b&&4===a%b)d=f[d>>>24]<<24^f[d>>16&255]<<16^f[d>>8&255]<<8^f[d&255],0===a%b&&(d=d<<8^d>>>24^e<<24,e=e<<1^283*(e>>7));k[a]=k[a-b]^d}for(b=0;a;b++,a--)d=k[b&3?a:a-4],c[b]=4>=a||4>b?d:g[0][f[d>>>24]]^g[1][f[d>>16&255]]^g[2][f[d>>8&255]]^g[3][f[d&255]]};p.cipher.aes.prototype={encrypt:function(a){return ba(this,a,0)},decrypt:function(a){return ba(this,a,1)},k:[[[],[],[],[],[]],[[],[],[],[],[]]],D:function(){var a=this.k[0],b=this.k[1],d=a[4],k=b[4],c,f,g,e=[],h=[],n,p,m,q;for(c=0;256>c;c++)h[(e[c]=
c<<1^283*(c>>7))^c]=c;for(f=g=0;!d[f];f^=n||1,g=h[g]||1)for(m=g^g<<1^g<<2^g<<3^g<<4,m=m>>8^m&255^99,d[f]=m,k[m]=f,p=e[c=e[n=e[f]]],q=16843009*p^65537*c^257*n^16843008*f,p=257*e[m]^16843008*m,c=0;4>c;c++)a[c][f]=p=p<<24^p>>>8,b[c][m]=q=q<<24^q>>>8;for(c=0;5>c;c++)a[c]=a[c].slice(0),b[c]=b[c].slice(0)}};p.bitArray={bitSlice:function(a,b,d){a=p.bitArray.P(a.slice(b/32),32-(b&31)).slice(1);return d===r?a:p.bitArray.clamp(a,d-b)},extract:function(a,b,d){var k=Math.floor(-b-d&31);return((b+d-1^b)&-32?a[b/
32|0]<<32-k^a[b/32+1|0]>>>k:a[b/32|0]>>>k)&(1<<d)-1},concat:function(a,b){if(0===a.length||0===b.length)return a.concat(b);var d=a[a.length-1],k=p.bitArray.getPartial(d);return 32===k?a.concat(b):p.bitArray.P(b,k,d|0,a.slice(0,a.length-1))},bitLength:function(a){var b=a.length;return 0===b?0:32*(b-1)+p.bitArray.getPartial(a[b-1])},clamp:function(a,b){if(32*a.length<b)return a;a=a.slice(0,Math.ceil(b/32));var d=a.length;b&=31;0<d&&b&&(a[d-1]=p.bitArray.partial(b,a[d-1]&2147483648>>b-1,1));return a},
partial:function(a,b,d){return 32===a?b:(d?b|0:b<<32-a)+1099511627776*a},getPartial:function(a){return Math.round(a/1099511627776)||32},equal:function(a,b){if(p.bitArray.bitLength(a)!==p.bitArray.bitLength(b))return!1;var d=0,k;for(k=0;k<a.length;k++)d|=a[k]^b[k];return 0===d},P:function(a,b,d,k){var c;for(k===r&&(k=[]);32<=b;b-=32)k.push(d),d=0;if(0===b)return k.concat(a);for(c=0;c<a.length;c++)k.push(d|a[c]>>>b),d=a[c]<<32-b;c=a.length?a[a.length-1]:0;a=p.bitArray.getPartial(c);k.push(p.bitArray.partial(b+
a&31,32<b+a?d:k.pop(),1));return k},l:function(a,b){return[a[0]^b[0],a[1]^b[1],a[2]^b[2],a[3]^b[3]]},byteswapM:function(a){var b,d;for(b=0;b<a.length;++b)d=a[b],a[b]=d>>>24|d>>>8&65280|(d&65280)<<8|d<<24;return a}};p.codec.utf8String={fromBits:function(a){var b="",d=p.bitArray.bitLength(a),k,c;for(k=0;k<d/8;k++)0===(k&3)&&(c=a[k/4]),b+=String.fromCharCode(c>>>24),c<<=8;return decodeURIComponent(escape(b))},toBits:function(a){a=unescape(encodeURIComponent(a));var b=[],d,c=0;for(d=0;d<a.length;d++)c=
c<<8|a.charCodeAt(d),3===(d&3)&&(b.push(c),c=0);d&3&&b.push(p.bitArray.partial(8*(d&3),c));return b}};p.codec.hex={fromBits:function(a){var b="",d;for(d=0;d<a.length;d++)b+=((a[d]|0)+0xf00000000000).toString(16).substr(4);return b.substr(0,p.bitArray.bitLength(a)/4)},toBits:function(a){var b,d=[],c;a=a.replace(/\s|0x/g,"");c=a.length;a+="00000000";for(b=0;b<a.length;b+=8)d.push(parseInt(a.substr(b,8),16)^0);return p.bitArray.clamp(d,4*c)}};p.codec.base64={J:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",
fromBits:function(a,b,d){var c="",l=0,f=p.codec.base64.J,g=0,e=p.bitArray.bitLength(a);d&&(f=f.substr(0,62)+"-_");for(d=0;6*c.length<e;)c+=f.charAt((g^a[d]>>>l)>>>26),6>l?(g=a[d]<<6-l,l+=26,d++):(g<<=6,l-=6);for(;c.length&3&&!b;)c+="\x3d";return c},toBits:function(a,b){a=a.replace(/\s|=/g,"");var d=[],c,l=0,f=p.codec.base64.J,g=0,e;b&&(f=f.substr(0,62)+"-_");for(c=0;c<a.length;c++)e=f.indexOf(a.charAt(c)),0>e&&w(new p.exception.invalid("this isn't base64!")),26<l?(l-=26,d.push(g^e>>>l),g=e<<32-l):
(l+=6,g^=e<<32-l);l&56&&d.push(p.bitArray.partial(l&56,g,1));return d}};p.codec.base64url={fromBits:function(a){return p.codec.base64.fromBits(a,1,1)},toBits:function(a){return p.codec.base64.toBits(a,1)}};p.hash.sha256=function(a){this.b[0]||this.D();a?(this.r=a.r.slice(0),this.o=a.o.slice(0),this.h=a.h):this.reset()};p.hash.sha256.hash=function(a){return(new p.hash.sha256).update(a).finalize()};p.hash.sha256.prototype={blockSize:512,reset:function(){this.r=this.N.slice(0);this.o=[];this.h=0;return this},
update:function(a){"string"===typeof a&&(a=p.codec.utf8String.toBits(a));var b,d=this.o=p.bitArray.concat(this.o,a);b=this.h;a=this.h=b+p.bitArray.bitLength(a);for(b=512+b&-512;b<=a;b+=512)N(this,d.splice(0,16));return this},finalize:function(){var a,b=this.o,d=this.r,b=p.bitArray.concat(b,[p.bitArray.partial(1,1)]);for(a=b.length+2;a&15;a++)b.push(0);b.push(Math.floor(this.h/4294967296));for(b.push(this.h|0);b.length;)N(this,b.splice(0,16));this.reset();return d},N:[],b:[],D:function(){function a(a){return 4294967296*
(a-Math.floor(a))|0}var b=0,d=2,c;a:for(;64>b;d++){for(c=2;c*c<=d;c++)if(0===d%c)continue a;8>b&&(this.N[b]=a(Math.pow(d,.5)));this.b[b]=a(Math.pow(d,1/3));b++}}};p.mode.ccm={name:"ccm",encrypt:function(a,b,d,c,l){var f,g=b.slice(0),e=p.bitArray,h=e.bitLength(d)/8,n=e.bitLength(g)/8;l=l||64;c=c||[];7>h&&w(new p.exception.invalid("ccm: iv must be at least 7 bytes"));for(f=2;4>f&&n>>>8*f;f++);f<15-h&&(f=15-h);d=e.clamp(d,8*(15-f));b=p.mode.ccm.L(a,b,d,c,l,f);g=p.mode.ccm.p(a,g,d,b,l,f);return e.concat(g.data,
g.tag)},decrypt:function(a,b,d,c,l){l=l||64;c=c||[];var f=p.bitArray,g=f.bitLength(d)/8,e=f.bitLength(b),h=f.clamp(b,e-l),n=f.bitSlice(b,e-l),e=(e-l)/8;7>g&&w(new p.exception.invalid("ccm: iv must be at least 7 bytes"));for(b=2;4>b&&e>>>8*b;b++);b<15-g&&(b=15-g);d=f.clamp(d,8*(15-b));h=p.mode.ccm.p(a,h,d,n,l,b);a=p.mode.ccm.L(a,h.data,d,c,l,b);f.equal(h.tag,a)||w(new p.exception.corrupt("ccm: tag doesn't match"));return h.data},L:function(a,b,d,c,l,f){var g=[],e=p.bitArray,h=e.l;l/=8;(l%2||4>l||16<
l)&&w(new p.exception.invalid("ccm: invalid tag length"));(4294967295<c.length||4294967295<b.length)&&w(new p.exception.bug("ccm: can't deal with 4GiB or more data"));f=[e.partial(8,(c.length?64:0)|l-2<<2|f-1)];f=e.concat(f,d);f[3]|=e.bitLength(b)/8;f=a.encrypt(f);if(c.length)for(d=e.bitLength(c)/8,65279>=d?g=[e.partial(16,d)]:4294967295>=d&&(g=e.concat([e.partial(16,65534)],[d])),g=e.concat(g,c),c=0;c<g.length;c+=4)f=a.encrypt(h(f,g.slice(c,c+4).concat([0,0,0])));for(c=0;c<b.length;c+=4)f=a.encrypt(h(f,
b.slice(c,c+4).concat([0,0,0])));return e.clamp(f,8*l)},p:function(a,b,d,c,l,f){var g,e=p.bitArray;g=e.l;var h=b.length,n=e.bitLength(b);d=e.concat([e.partial(8,f-1)],d).concat([0,0,0]).slice(0,4);c=e.bitSlice(g(c,a.encrypt(d)),0,l);if(!h)return{tag:c,data:[]};for(g=0;g<h;g+=4)d[3]++,l=a.encrypt(d),b[g]^=l[0],b[g+1]^=l[1],b[g+2]^=l[2],b[g+3]^=l[3];return{tag:c,data:e.clamp(b,n)}}};p.mode.ocb2={name:"ocb2",encrypt:function(a,b,d,c,l,f){128!==p.bitArray.bitLength(d)&&w(new p.exception.invalid("ocb iv must be 128 bits"));
var g,e=p.mode.ocb2.H,h=p.bitArray,n=h.l,m=[0,0,0,0];d=e(a.encrypt(d));var q,r=[];c=c||[];l=l||64;for(g=0;g+4<b.length;g+=4)q=b.slice(g,g+4),m=n(m,q),r=r.concat(n(d,a.encrypt(n(d,q)))),d=e(d);q=b.slice(g);b=h.bitLength(q);g=a.encrypt(n(d,[0,0,0,b]));q=h.clamp(n(q.concat([0,0,0]),g),b);m=n(m,n(q.concat([0,0,0]),g));m=a.encrypt(n(m,n(d,e(d))));c.length&&(m=n(m,f?c:p.mode.ocb2.pmac(a,c)));return r.concat(h.concat(q,h.clamp(m,l)))},decrypt:function(a,b,d,c,l,f){128!==p.bitArray.bitLength(d)&&w(new p.exception.invalid("ocb iv must be 128 bits"));
l=l||64;var g=p.mode.ocb2.H,e=p.bitArray,h=e.l,n=[0,0,0,0],m=g(a.encrypt(d)),q,r,s=p.bitArray.bitLength(b)-l,t=[];c=c||[];for(d=0;d+4<s/32;d+=4)q=h(m,a.decrypt(h(m,b.slice(d,d+4)))),n=h(n,q),t=t.concat(q),m=g(m);r=s-32*d;q=a.encrypt(h(m,[0,0,0,r]));q=h(q,e.clamp(b.slice(d),r).concat([0,0,0]));n=h(n,q);n=a.encrypt(h(n,h(m,g(m))));c.length&&(n=h(n,f?c:p.mode.ocb2.pmac(a,c)));e.equal(e.clamp(n,l),e.bitSlice(b,s))||w(new p.exception.corrupt("ocb: tag doesn't match"));return t.concat(e.clamp(q,r))},pmac:function(a,
b){var d,c=p.mode.ocb2.H,l=p.bitArray,f=l.l,g=[0,0,0,0],e=a.encrypt([0,0,0,0]),e=f(e,c(c(e)));for(d=0;d+4<b.length;d+=4)e=c(e),g=f(g,a.encrypt(f(e,b.slice(d,d+4))));d=b.slice(d);128>l.bitLength(d)&&(e=f(e,c(e)),d=l.concat(d,[-2147483648,0,0,0]));g=f(g,d);return a.encrypt(f(c(f(e,c(e))),g))},H:function(a){return[a[0]<<1^a[1]>>>31,a[1]<<1^a[2]>>>31,a[2]<<1^a[3]>>>31,a[3]<<1^135*(a[0]>>>31)]}};p.mode.gcm={name:"gcm",encrypt:function(a,b,d,c,l){var f=b.slice(0);b=p.bitArray;c=c||[];a=p.mode.gcm.p(!0,
a,f,c,d,l||128);return b.concat(a.data,a.tag)},decrypt:function(a,b,d,c,l){var f=b.slice(0),g=p.bitArray,e=g.bitLength(f);l=l||128;c=c||[];l<=e?(b=g.bitSlice(f,e-l),f=g.bitSlice(f,0,e-l)):(b=f,f=[]);a=p.mode.gcm.p(!1,a,f,c,d,l);g.equal(a.tag,b)||w(new p.exception.corrupt("gcm: tag doesn't match"));return a.data},Z:function(a,b){var d,c,l,f,g,e=p.bitArray.l;l=[0,0,0,0];f=b.slice(0);for(d=0;128>d;d++){0!==(a[Math.floor(d/32)]&1<<31-d%32)&&(l=e(l,f));g=0!==(f[3]&1);for(c=3;0<c;c--)f[c]=f[c]>>>1|(f[c-
1]&1)<<31;f[0]>>>=1;g&&(f[0]^=-520093696)}return l},g:function(a,b,d){var c,l=d.length;b=b.slice(0);for(c=0;c<l;c+=4)b[0]^=4294967295&d[c],b[1]^=4294967295&d[c+1],b[2]^=4294967295&d[c+2],b[3]^=4294967295&d[c+3],b=p.mode.gcm.Z(b,a);return b},p:function(a,b,d,c,l,f){var g,e,h,n,m,q,r,s,t=p.bitArray;q=d.length;r=t.bitLength(d);s=t.bitLength(c);e=t.bitLength(l);g=b.encrypt([0,0,0,0]);96===e?(l=l.slice(0),l=t.concat(l,[1])):(l=p.mode.gcm.g(g,[0,0,0,0],l),l=p.mode.gcm.g(g,l,[0,0,Math.floor(e/4294967296),
e&4294967295]));e=p.mode.gcm.g(g,[0,0,0,0],c);m=l.slice(0);c=e.slice(0);a||(c=p.mode.gcm.g(g,e,d));for(n=0;n<q;n+=4)m[3]++,h=b.encrypt(m),d[n]^=h[0],d[n+1]^=h[1],d[n+2]^=h[2],d[n+3]^=h[3];d=t.clamp(d,r);a&&(c=p.mode.gcm.g(g,e,d));a=[Math.floor(s/4294967296),s&4294967295,Math.floor(r/4294967296),r&4294967295];c=p.mode.gcm.g(g,c,a);h=b.encrypt(l);c[0]^=h[0];c[1]^=h[1];c[2]^=h[2];c[3]^=h[3];return{tag:t.bitSlice(c,0,f),data:d}}};p.misc.hmac=function(a,b){this.M=b=b||p.hash.sha256;var d=[[],[]],c,l=b.prototype.blockSize/
32;this.n=[new b,new b];a.length>l&&(a=b.hash(a));for(c=0;c<l;c++)d[0][c]=a[c]^909522486,d[1][c]=a[c]^1549556828;this.n[0].update(d[0]);this.n[1].update(d[1]);this.G=new b(this.n[0])};p.misc.hmac.prototype.encrypt=p.misc.hmac.prototype.mac=function(a){this.Q&&w(new p.exception.invalid("encrypt on already updated hmac called!"));this.update(a);return this.digest(a)};p.misc.hmac.prototype.reset=function(){this.G=new this.M(this.n[0]);this.Q=!1};p.misc.hmac.prototype.update=function(a){this.Q=!0;this.G.update(a)};
p.misc.hmac.prototype.digest=function(){var a=this.G.finalize(),a=(new this.M(this.n[1])).update(a).finalize();this.reset();return a};p.misc.pbkdf2=function(a,b,d,c,l){d=d||1E3;(0>c||0>d)&&w(p.exception.invalid("invalid params to pbkdf2"));"string"===typeof a&&(a=p.codec.utf8String.toBits(a));"string"===typeof b&&(b=p.codec.utf8String.toBits(b));l=l||p.misc.hmac;a=new l(a);var f,g,e,h,n=[],m=p.bitArray;for(h=1;32*n.length<(c||1);h++){l=f=a.encrypt(m.concat(b,[h]));for(g=1;g<d;g++)for(f=a.encrypt(f),
e=0;e<f.length;e++)l[e]^=f[e];n=n.concat(l)}c&&(n=m.clamp(n,c));return n};p.prng=function(a){this.c=[new p.hash.sha256];this.i=[0];this.F=0;this.s={};this.C=0;this.K={};this.O=this.d=this.j=this.W=0;this.b=[0,0,0,0,0,0,0,0];this.f=[0,0,0,0];this.A=r;this.B=a;this.q=!1;this.w={progress:{},seeded:{}};this.m=this.V=0;this.t=1;this.u=2;this.S=65536;this.I=[0,48,64,96,128,192,256,384,512,768,1024];this.T=3E4;this.R=80};p.prng.prototype={randomWords:function(a,b){var d=[],c;c=this.isReady(b);var l;c===
this.m&&w(new p.exception.notReady("generator isn't seeded"));if(c&this.u){c=!(c&this.t);l=[];var f=0,g;this.O=l[0]=(new Date).valueOf()+this.T;for(g=0;16>g;g++)l.push(4294967296*Math.random()|0);for(g=0;g<this.c.length&&(l=l.concat(this.c[g].finalize()),f+=this.i[g],this.i[g]=0,c||!(this.F&1<<g));g++);this.F>=1<<this.c.length&&(this.c.push(new p.hash.sha256),this.i.push(0));this.d-=f;f>this.j&&(this.j=f);this.F++;this.b=p.hash.sha256.hash(this.b.concat(l));this.A=new p.cipher.aes(this.b);for(c=0;4>
c&&(this.f[c]=this.f[c]+1|0,!this.f[c]);c++);}for(c=0;c<a;c+=4)0===(c+1)%this.S&&Y(this),l=P(this),d.push(l[0],l[1],l[2],l[3]);Y(this);return d.slice(0,a)},setDefaultParanoia:function(a,b){0===a&&"Setting paranoia\x3d0 will ruin your security; use it only for testing"!==b&&w("Setting paranoia\x3d0 will ruin your security; use it only for testing");this.B=a},addEntropy:function(a,b,d){d=d||"user";var c,l,f=(new Date).valueOf(),g=this.s[d],e=this.isReady(),h=0;c=this.K[d];c===r&&(c=this.K[d]=this.W++);
g===r&&(g=this.s[d]=0);this.s[d]=(this.s[d]+1)%this.c.length;switch(typeof a){case "number":b===r&&(b=1);this.c[g].update([c,this.C++,1,b,f,1,a|0]);break;case "object":d=Object.prototype.toString.call(a);if("[object Uint32Array]"===d){l=[];for(d=0;d<a.length;d++)l.push(a[d]);a=l}else for("[object Array]"!==d&&(h=1),d=0;d<a.length&&!h;d++)"number"!==typeof a[d]&&(h=1);if(!h){if(b===r)for(d=b=0;d<a.length;d++)for(l=a[d];0<l;)b++,l>>>=1;this.c[g].update([c,this.C++,2,b,f,a.length].concat(a))}break;case "string":b===
r&&(b=a.length);this.c[g].update([c,this.C++,3,b,f,a.length]);this.c[g].update(a);break;default:h=1}h&&w(new p.exception.bug("random: addEntropy only supports number, array of numbers or string"));this.i[g]+=b;this.d+=b;e===this.m&&(this.isReady()!==this.m&&ca("seeded",Math.max(this.j,this.d)),ca("progress",this.getProgress()))},isReady:function(a){a=this.I[a!==r?a:this.B];return this.j&&this.j>=a?this.i[0]>this.R&&(new Date).valueOf()>this.O?this.u|this.t:this.t:this.d>=a?this.u|this.m:this.m},getProgress:function(a){a=
this.I[a?a:this.B];return this.j>=a?1:this.d>a?1:this.d/a},startCollectors:function(){this.q||(this.a={loadTimeCollector:aa(this,this.aa),mouseCollector:aa(this,this.ba),keyboardCollector:aa(this,this.$),accelerometerCollector:aa(this,this.U)},window.addEventListener?(window.addEventListener("load",this.a.loadTimeCollector,!1),window.addEventListener("mousemove",this.a.mouseCollector,!1),window.addEventListener("keypress",this.a.keyboardCollector,!1),window.addEventListener("devicemotion",this.a.accelerometerCollector,
!1)):document.attachEvent?(document.attachEvent("onload",this.a.loadTimeCollector),document.attachEvent("onmousemove",this.a.mouseCollector),document.attachEvent("keypress",this.a.keyboardCollector)):w(new p.exception.bug("can't attach event")),this.q=!0)},stopCollectors:function(){this.q&&(window.removeEventListener?(window.removeEventListener("load",this.a.loadTimeCollector,!1),window.removeEventListener("mousemove",this.a.mouseCollector,!1),window.removeEventListener("keypress",this.a.keyboardCollector,
!1),window.removeEventListener("devicemotion",this.a.accelerometerCollector,!1)):document.detachEvent&&(document.detachEvent("onload",this.a.loadTimeCollector),document.detachEvent("onmousemove",this.a.mouseCollector),document.detachEvent("keypress",this.a.keyboardCollector)),this.q=!1)},addEventListener:function(a,b){this.w[a][this.V++]=b},removeEventListener:function(a,b){var d,c,l=this.w[a],f=[];for(c in l)l.hasOwnProperty(c)&&l[c]===b&&f.push(c);for(d=0;d<f.length;d++)c=f[d],delete l[c]},$:function(){U(1)},
ba:function(a){var b,d;try{b=a.x||a.clientX||a.offsetX||0,d=a.y||a.clientY||a.offsetY||0}catch(c){d=b=0}0!=b&&0!=d&&p.random.addEntropy([b,d],2,"mouse");U(0)},aa:function(){U(2)},U:function(a){a=(a.accelerationIncludingGravity||{}).x||(a.accelerationIncludingGravity||{}).y||(a.accelerationIncludingGravity||{}).z;if(window.orientation){var b=window.orientation;"number"===typeof b&&p.random.addEntropy(b,1,"accelerometer")}a&&p.random.addEntropy(a,2,"accelerometer");U(0)}};p.random=new p.prng(6);a:try{var n,
V,W,X;if(X="undefined"!==typeof module){var Z;if(Z=module.exports){var $;try{$=require("crypto")}catch(ga){$=null}Z=(V=$)&&V.randomBytes}X=Z}if(X)n=V.randomBytes(128),n=new Uint32Array((new Uint8Array(n)).buffer),p.random.addEntropy(n,1024,"crypto['randomBytes']");else if("undefined"!==typeof window&&"undefined"!==typeof Uint32Array){W=new Uint32Array(32);if(window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(W);else if(window.msCrypto&&window.msCrypto.getRandomValues)window.msCrypto.getRandomValues(W);
else break a;p.random.addEntropy(W,1024,"crypto['getRandomValues']")}}catch(ha){"undefined"!==typeof window&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(ha))}p.json={defaults:{v:1,iter:1E3,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},Y:function(a,b,d,c){d=d||{};c=c||{};var l=p.json,f=l.e({iv:p.random.randomWords(4,0)},l.defaults),g;l.e(f,d);d=f.adata;"string"===typeof f.salt&&(f.salt=p.codec.base64.toBits(f.salt));"string"===typeof f.iv&&(f.iv=
p.codec.base64.toBits(f.iv));(!p.mode[f.mode]||!p.cipher[f.cipher]||"string"===typeof a&&100>=f.iter||64!==f.ts&&96!==f.ts&&128!==f.ts||128!==f.ks&&192!==f.ks&&256!==f.ks||2>f.iv.length||4<f.iv.length)&&w(new p.exception.invalid("json encrypt: invalid parameters"));"string"===typeof a?(g=p.misc.cachedPbkdf2(a,f),a=g.key.slice(0,f.ks/32),f.salt=g.salt):p.ecc&&a instanceof p.ecc.elGamal.publicKey&&(g=a.kem(),f.kemtag=g.tag,a=g.key.slice(0,f.ks/32));"string"===typeof b&&(b=p.codec.utf8String.toBits(b));
"string"===typeof d&&(d=p.codec.utf8String.toBits(d));g=new p.cipher[f.cipher](a);l.e(c,f);c.key=a;f.ct=p.mode[f.mode].encrypt(g,b,f.iv,d,f.ts);return f},encrypt:function(a,b,d,c){var l=p.json,f=l.Y.apply(l,arguments);return l.encode(f)},X:function(a,b,d,c){d=d||{};c=c||{};var l=p.json;b=l.e(l.e(l.e({},l.defaults),b),d,!0);var f,g;f=b.adata;"string"===typeof b.salt&&(b.salt=p.codec.base64.toBits(b.salt));"string"===typeof b.iv&&(b.iv=p.codec.base64.toBits(b.iv));(!p.mode[b.mode]||!p.cipher[b.cipher]||
"string"===typeof a&&100>=b.iter||64!==b.ts&&96!==b.ts&&128!==b.ts||128!==b.ks&&192!==b.ks&&256!==b.ks||!b.iv||2>b.iv.length||4<b.iv.length)&&w(new p.exception.invalid("json decrypt: invalid parameters"));"string"===typeof a?(g=p.misc.cachedPbkdf2(a,b),a=g.key.slice(0,b.ks/32),b.salt=g.salt):p.ecc&&a instanceof p.ecc.elGamal.secretKey&&(a=a.unkem(p.codec.base64.toBits(b.kemtag)).slice(0,b.ks/32));"string"===typeof f&&(f=p.codec.utf8String.toBits(f));g=new p.cipher[b.cipher](a);f=p.mode[b.mode].decrypt(g,
b.ct,b.iv,f,b.ts);l.e(c,b);c.key=a;return 1===d.raw?f:p.codec.utf8String.fromBits(f)},decrypt:function(a,b,d,c){var l=p.json;return l.X(a,l.decode(b),d,c)},encode:function(a){var b,d="{",c="";for(b in a)if(a.hasOwnProperty(b))switch(b.match(/^[a-z0-9]+$/i)||w(new p.exception.invalid("json encode: invalid property name")),d+=c+'"'+b+'":',c=",",typeof a[b]){case "number":case "boolean":d+=a[b];break;case "string":d+='"'+escape(a[b])+'"';break;case "object":d+='"'+p.codec.base64.fromBits(a[b],0)+'"';
break;default:w(new p.exception.bug("json encode: unsupported type"))}return d+"}"},decode:function(a){a=a.replace(/\s/g,"");a.match(/^\{.*\}$/)||w(new p.exception.invalid("json decode: this isn't json!"));a=a.replace(/^\{|\}$/g,"").split(/,/);var b={},d,c;for(d=0;d<a.length;d++)(c=a[d].match(/^(?:(["']?)([a-z][a-z0-9]*)\1):(?:(\d+)|"([a-z0-9+\/%*_.@=\-]*)")$/i))||w(new p.exception.invalid("json decode: this isn't json!")),b[c[2]]=c[3]?parseInt(c[3],10):c[2].match(/^(ct|salt|iv)$/)?p.codec.base64.toBits(c[4]):
unescape(c[4]);return b},e:function(a,b,d){a===r&&(a={});if(b===r)return a;for(var c in b)b.hasOwnProperty(c)&&(d&&a[c]!==r&&a[c]!==b[c]&&w(new p.exception.invalid("required parameter overridden")),a[c]=b[c]);return a},ea:function(a,b){var d={},c;for(c in a)a.hasOwnProperty(c)&&a[c]!==b[c]&&(d[c]=a[c]);return d},da:function(a,b){var d={},c;for(c=0;c<b.length;c++)a[b[c]]!==r&&(d[b[c]]=a[b[c]]);return d}};p.encrypt=p.json.encrypt;p.decrypt=p.json.decrypt;p.misc.ca={};p.misc.cachedPbkdf2=function(a,
b){var d=p.misc.ca,c;b=b||{};c=b.iter||1E3;d=d[a]=d[a]||{};c=d[c]=d[c]||{firstSalt:b.salt&&b.salt.length?b.salt.slice(0):p.random.randomWords(2,0)};d=b.salt===r?c.firstSalt:b.salt;c[d]=c[d]||p.misc.pbkdf2(a,d,b.iter);return{key:c[d].slice(0),salt:d.slice(0)}};(function(a){var b=a.codec.bytes=a.codec.bytes||{};b.fromBits=b.fromBits||function(b){var c=[],l=a.bitArray.bitLength(b),f,g;for(f=0;f<l/8;f++)0===(f&3)&&(g=b[f/4]),c.push(g>>>24),g<<=8;return c};b.toBits=b.toBits||function(b){var c=[],l,f=0;
for(l=0;l<b.length;l++)f=f<<8|b[l],3===(l&3)&&(c.push(f),f=0);l&3&&c.push(a.bitArray.partial(8*(l&3),f));return c}})(p);var s;(function(){function a(a,b,c,d){if("function"===typeof a.addEventListener)a.addEventListener(b,c,d);else if(a.attachEvent)a.attachEvent("on"+b,c);else throw Error(L.errors.UNABLETOBIND+": Unable to bind "+b+"-event");}function b(a){var b=function(){return{}};window.jQuery&&"function"==typeof window.jQuery._data&&(b=function(a){return window.jQuery._data(a,"events")});for(var c=
a,d=0,e=[],h="onmousedown onmouseup onmouseover onmouseout onclick onmousemove ondblclick onerror onresize onscroll onkeydown onkeyup onkeypress onchange onsubmit".split(" "),n=h.length,m=0;c&&c!==c.documentElement;){m++;for(var p=n,q,r=(c.nodeName||c.tagName||"").toUpperCase().substring(0,3);p--;)q=h[p],c[name]&&(q=q+(c===a?"Own":"Par")+r,d++,e[q]=e[q]||0,e[q]++);var s=b(c);if("object"===typeof s)for(q in s)s.hasOwnProperty(q)&&(p=s[q].length,q=q+(c===a?"Own":"Par")+r,e[q]=e[q]||0,e[q]+=p,d+=p);
if(!c.parentNode)break;c=c.parentNode}a=["total\x3d"+d];for(var t in e)e.hasOwnProperty(t)&&0<e[t]&&a.push(t+"\x3d"+e[t]);return a.join("\x26")}var c=(new Date).getTime();s=s||function(){var k={};return function(l,f,g){if("bind"===l)s(g+"Bind"),a(f,"change",function(a){s(g+"FieldChangeCount");s("log",g,"ch");try{s("set",g+"FieldEvHa",b(f))}catch(c){s("set",g+"FieldEvHa","Err")}},!0),a(f,"click",function(){s(g+"FieldClickCount");s("log",g,"cl")},!0),a(f,"focus",function(){s(g+"FieldFocusCount");s("log",
g,"fo")},!0),a(f,"blur",function(){s(g+"FieldBlurCount");s("log",g,"bl")},!0),a(f,"touchstart",function(){s(g+"FieldTouchStartCount");s("log",g,"Ts")},!0),a(f,"touchend",function(){s(g+"FieldTouchEndCount");s("log",g,"Te")},!0),a(f,"touchcancel",function(){s(g+"FieldTouchCancelCount");s("log",g,"Tc")},!0),a(f,"keyup",function(a){16==a.keyCode?s("log",g,"Su"):17==a.keyCode?s("log",g,"Cu"):18==a.keyCode&&s("log",g,"Au")}),a(f,"keydown",function(a){s(g+"FieldKeyCount");switch(a&&a.keyCode){case 8:s("log",
g,"Kb");break;case 16:s("log",g,"Sd");break;case 17:s("log",g,"Cd");break;case 18:s("log",g,"Ad");break;case 37:s("log",g,"Kl");break;case 39:s("log",g,"Kr");break;case 46:s("log",g,"Kd");break;case 32:s("log",g,"Ks");break;default:48<=a.keyCode&&57>=a.keyCode||96<=a.keyCode&&105>=a.keyCode?s("log",g,"KN"):65<=a.keyCode&&90>=a.keyCode?s("log",g,"KL"):(s("log",g,"KU"),s("log",g+"UnkKeys",a.keyCode))}},!0);else if("set"===l)k[f]=g;else if("log"===l){l=f+"FieldLog";var e=(new Date).getTime()-c,e=Math.round(e/
100);k.hasOwnProperty(l)?k[l]+=","+g+"@"+e:k[l]=g+"@"+e;1500<k[l].length&&(k[l]=k[l].substring(k[l].length-1500),k[l]=k[l].substring(k[l].indexOf(",")+1))}else if("extend"===l)for(e in k)"number"!==e&&"expiryMonth"!==e&&"expiryYear"!==e&&"generationtime"!==e&&"holderName"!==e&&"cvc"!==e&&k.hasOwnProperty(e)&&(f[e]=""+k[e]);else k.hasOwnProperty(l)?k[l]++:k[l]=1}}();window&&(window.attachEvent||window.addEventListener)&&(a(window,"focus",function(){s("activate");window.location&&"string"==typeof window.location.href&&
s("set","referrer",window.location.href)}),a(window,"blur",function(){s("deactivate")}))})();var D=e.adyen=e.adyen||{},L=D.encrypt=D.encrypt||{createEncryption:function(a,b){return new O(a,b)}};"function"===typeof h&&h.amd?h("adyen/encrypt",[],function(){return L}):"undefined"!==typeof module&&module.exports&&(module.exports=L);L.errors=L.errors||{};L.version="0_1_20_1";var B={};B.luhnCheck=function(){var a={};return function(){var b=arguments,b=0<arguments.length?b[0]:this.cardnumber;if(isNaN(parseInt(b,
10)))return!1;var c=b.length,k=c&1,e=0;if("undefined"===typeof a[b]){14<=c&&s("luhnCount");for(var f=0;f<c;f++){var g=parseInt(b.charAt(f),10);f&1^k||(g*=2,9<g&&(g-=9));e+=g}0===e%10?(s("luhnOkCount"),a[b]=!0):(s("luhnFailCount"),a[b]=!1)}var k=0,h;for(h in a)a.hasOwnProperty(h)&&h.length===c&&k++;s("set","luhnSameLengthCount",k);return a[b]}}();B.numberCheck=function(a){return(a||"").replace(/[^\d]/g,"").match(/^\d{10,20}$/)&&B.luhnCheck(a)?!0:!1};B.cvcCheck=function(a){return a&&a.match&&a.match(/^\d{3,4}$/)?
!0:!1};B.yearCheck=function(a){if(!a||!a.match||!a.match(/^2\d{3}$/))return!1;a=parseInt(a,10);var b=(new Date).getFullYear();return a>=b-2&&a<=b+15};B.monthCheck=function(a){a=(a||"").replace(/^0(\d)$/,"$1");return a.match(/^([1-9]|10|11|12)$/)&&1<=parseInt(a,10)&&12>=parseInt(a,10)?!0:!1};B.holderNameCheck=function(a){return a&&a.match&&a.match(/\S/)?!0:!1};B.generationTimeValidDate=function(a){return"string"!==typeof a?!1:(a=a.match(/^(\d{4})-?(\d{2})-?(\d{2})$/))&&(""+a[1]).match(/^20[1-9][0-9]$/)&&
(""+a[2]).match(/^(12|11|10|0[1-9])$/)&&(""+a[3]).match(/^(31|30|20|10|[012][1-9])$/)?!0:!1};B.generationTimeValidTime=function(a){if("string"!==typeof a)return!1;var b=/(Z|[\+\-][012345][0-9]:?[012345][0-9])$/;return a.match(b)?a.replace(b,"").replace(/\.\d{3}$/,"").match(/^[012345][0-9]:?[012345][0-9]:?[012345][0-9]$/):!1};B.generationTimeCheck=function(a){if("string"!==typeof a)return!1;a=a.split("T");return 2===a.length&&B.generationTimeValidDate(a[0])&&B.generationTimeValidTime(a[1])?!0:!1};
var O=function(a,b){try{p.random.startCollectors()}catch(c){}this.key=a;this.options=b||{};"undefined"===typeof this.options.numberIgnoreNonNumeric&&(this.options.numberIgnoreNonNumeric=!0);"undefined"!==typeof this.options.cvcIgnoreFornumber&&delete this.options.cvcIgnoreFornumber;"undefined"===typeof this.options.fourDigitCvcForBins&&(this.options.fourDigitCvcForBins="34,37");"undefined"!==typeof this.options.cvcLengthFornumber&&delete this.options.cvcLengthFornumber;if("string"===typeof this.options.cvcIgnoreBins){var k=
[];this.options.cvcIgnoreBins.replace(/\d+/g,function(a){0<a.length&&!isNaN(parseInt(a,10))&&k.push(a);return a});0<k.length&&(this.options.cvcIgnoreFornumber=new RegExp("^\\s*("+k.join("|")+")"))}else"undefined"!==typeof this.options.cvcIgnoreBins&&delete this.options.cvcIgnoreBins;if("string"===typeof this.options.fourDigitCvcForBins){var e=[];this.options.fourDigitCvcForBins.replace(/\d+/g,function(a){0<a.length&&!isNaN(parseInt(a,10))&&e.push(a);return a});0<e.length&&(this.options.cvcLengthFornumber=
{matcher:new RegExp("^\\s*("+e.join("|")+")"),requiredLength:4})}delete this.options.fourDigitCvcForBins;s("initializeCount")};O.prototype.createRSAKey=function(){var a=this.key.split("|");if(2!==a.length)throw"Malformed public key";var b=a[0],a=a[1],c=new M;c.setPublic(a,b);return c};O.prototype.createAESKey=function(){return new c};O.prototype.encrypt=function(a){var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);a={};"undefined"!==typeof b.number&&(a.number=b.number);"undefined"!==typeof b.cvc&&
(a.cvc=b.cvc);"undefined"!==typeof b.expiryMonth&&(a.month=b.expiryMonth);"undefined"!==typeof b.expiryYear&&(a.year=b.expiryYear);"undefined"!==typeof b.holderName&&(a.holderName=b.holderName);"undefined"!==typeof b.generationtime&&(a.generationtime=b.generationtime);if(!1!==this.options.enableValidations&&!1===this.validate(a).valid)return!1;for(a=0;11>a;a++)if(p.random&&p.random.isReady(a))s("set","sjclStrength",a);else break;s("extend",b);try{b.dfValue=""}catch(k){}a=this.createRSAKey();c=this.createAESKey();
b=c.encrypt(JSON.stringify(b));c=p.codec.bytes.fromBits(c.key());a=a.encrypt_b64(c);return["adyenjs_"+L.version+"$",a,"$",b].join("")};O.prototype.validate=function(a){var b={valid:!0};if("object"!==typeof a)return b.valid=!1,b;for(var c in a)if(a.hasOwnProperty(c)&&"undefined"!==typeof a[c]){var k=a[c];this.options[c+"IgnoreNonNumeric"]&&(k=k.replace(/\D/g,""));if(!this.options[c+"SkipValidation"]){for(var e in a)if(a.hasOwnProperty(e)){var f=this.options[c+"IgnoreFor"+e],g=this.options[c+"LengthFor"+
e];f&&a[e].match(f)?b[c]=!0:g&&g.matcher&&g.requiredLength&&a[e].match(g.matcher)&&k.length!==g.requiredLength&&(b[c]=!1)}if(b.hasOwnProperty(c))b.valid=b.valid&&b[c];else switch(c){case "number":b.number=B.numberCheck(k);b.luhn=b.number;b.valid=b.valid&&b.number;break;case "expiryYear":case "year":b.year=B.yearCheck(k);b.expiryYear=b.year;b.valid=b.valid&&b.year;break;case "cvc":b.cvc=B.cvcCheck(k);b.valid=b.valid&&b.cvc;break;case "expiryMonth":case "month":b.month=B.monthCheck(k);b.expiryMonth=
b.month;b.valid=b.valid&&b.month;break;case "holderName":b.holderName=B.holderNameCheck(k);b.valid=b.valid&&b.holderName;break;case "generationtime":b.generationtime=B.generationTimeCheck(k);b.valid=b.valid&&b.generationtime;break;default:b.unknown=b.unknown||[],b.unknown.push(c),b.valid=!1}}}return b};O.prototype.monitor=function(a,b){if("string"!==typeof a||"number"!==a&&"cvc"!==a&&"holderName"!==a)throw Error("invalid fieldname. Expected 'number', 'cvc' or 'holderName', but received '"+a+"'");
s("bind",b,a)};var c=function(){};c.prototype={constructor:c,key:function(){return this._key=this._key||p.random.randomWords(8,6)},encrypt:function(a){return this.encryptWithIv(a,p.random.randomWords(3,6))},encryptWithIv:function(a,b){var c,k;c=new p.cipher.aes(this.key());k=p.codec.utf8String.toBits(a);c=p.mode.ccm.encrypt(c,k,b);c=p.bitArray.concat(b,c);return p.codec.base64.fromBits(c)}}})(this,"function"===typeof define?define:null);
(function(){function e(){this.n=null;this.e=0;this.coeff=this.dmq1=this.dmp1=this.q=this.p=this.d=null}function h(c,a,b){null!=c&&("number"==typeof c?this.fromNumber(c,a,b):null==a&&"string"!=typeof c?this.fromString(c,256):this.fromString(c,a))}function m(){return new h(null)}function q(c,a,b,d,k,e){for(;0<=--e;){var f=a*this[c++]+b[d]+k;k=Math.floor(f/67108864);b[d++]=f&67108863}return k}function t(c,a,b,d,k,e){var f=a&32767;for(a>>=15;0<=--e;){var g=this[c]&32767,h=this[c++]>>15,n=a*g+h*f,g=f*
g+((n&32767)<<15)+b[d]+(k&1073741823);k=(g>>>30)+(n>>>15)+a*h+(k>>>30);b[d++]=g&1073741823}return k}function C(c,a,b,d,k,e){var f=a&16383;for(a>>=14;0<=--e;){var g=this[c]&16383,h=this[c++]>>14,n=a*g+h*f,g=f*g+((n&16383)<<14)+b[d]+k;k=(g>>28)+(n>>14)+a*h;b[d++]=g&268435455}return k}function I(c){var a=m();a.fromInt(c);return a}function G(c){var a=1,b;0!=(b=c>>>16)&&(c=b,a+=16);0!=(b=c>>8)&&(c=b,a+=8);0!=(b=c>>4)&&(c=b,a+=4);0!=(b=c>>2)&&(c=b,a+=2);0!=c>>1&&(a+=1);return a}function H(c){this.m=c}function E(c){this.m=
c;this.mp=c.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<c.DB-15)-1;this.mt2=2*c.t}function J(c){y[u++]^=c&255;y[u++]^=c>>8&255;y[u++]^=c>>16&255;y[u++]^=c>>24&255;u>=p&&(u-=p)}function S(){}function T(){this.j=this.i=0;this.S=[]}function x(c){throw c;}function M(c,a,b){4!==a.length&&x(new n.exception.invalid("invalid aes block size"));var d=c.b[b],k=a[0]^d[0],e=a[b?3:1]^d[1],f=a[2]^d[2];a=a[b?1:3]^d[3];var g,h,m,p=d.length/4-2,q,r=4,s=[0,0,0,0];g=c.k[b];c=g[0];var t=g[1],u=
g[2],w=g[3],fa=g[4];for(q=0;q<p;q++)g=c[k>>>24]^t[e>>16&255]^u[f>>8&255]^w[a&255]^d[r],h=c[e>>>24]^t[f>>16&255]^u[a>>8&255]^w[k&255]^d[r+1],m=c[f>>>24]^t[a>>16&255]^u[k>>8&255]^w[e&255]^d[r+2],a=c[a>>>24]^t[k>>16&255]^u[e>>8&255]^w[f&255]^d[r+3],r+=4,k=g,e=h,f=m;for(q=0;4>q;q++)s[b?3&-q:q]=fa[k>>>24]<<24^fa[e>>16&255]<<16^fa[f>>8&255]<<8^fa[a&255]^d[r++],g=k,k=e,e=f,f=a,a=g;return s}function w(c,a){var b,d,k,e=a.slice(0),f=c.r,g=c.b,h=f[0],n=f[1],m=f[2],p=f[3],q=f[4],r=f[5],s=f[6],t=f[7];for(b=0;64>
b;b++)16>b?d=e[b]:(d=e[b+1&15],k=e[b+14&15],d=e[b&15]=(d>>>7^d>>>18^d>>>3^d<<25^d<<14)+(k>>>17^k>>>19^k>>>10^k<<15^k<<13)+e[b&15]+e[b+9&15]|0),d=d+t+(q>>>6^q>>>11^q>>>25^q<<26^q<<21^q<<7)+(s^q&(r^s))+g[b],t=s,s=r,r=q,q=p+d|0,p=m,m=n,n=h,h=d+(n&m^p&(n^m))+(n>>>2^n>>>13^n>>>22^n<<30^n<<19^n<<10)|0;f[0]=f[0]+h|0;f[1]=f[1]+n|0;f[2]=f[2]+m|0;f[3]=f[3]+p|0;f[4]=f[4]+q|0;f[5]=f[5]+r|0;f[6]=f[6]+s|0;f[7]=f[7]+t|0}function ba(c,a){var b,d=n.random.w[c],k=[];for(b in d)d.hasOwnProperty(b)&&k.push(d[b]);for(b=
0;b<k.length;b++)k[b](a)}function N(c){"undefined"!==typeof window&&window.performance&&"function"===typeof window.performance.now?n.random.addEntropy(window.performance.now(),c,"loadtime"):n.random.addEntropy((new Date).valueOf(),c,"loadtime")}function ca(c){c.b=U(c).concat(U(c));c.A=new n.cipher.aes(c.b)}function U(c){for(var a=0;4>a&&(c.f[a]=c.f[a]+1|0,!c.f[a]);a++);return c.A.encrypt(c.f)}function Y(c,a){return function(){a.apply(c,arguments)}}e.prototype.doPublic=function(c){return c.modPowInt(this.e,
this.n)};e.prototype.setPublic=function(c,a){null!=c&&null!=a&&0<c.length&&0<a.length?(this.n=new h(c,16),this.e=parseInt(a,16)):alert("Invalid RSA public key")};e.prototype.encrypt=function(c){var a;a=this.n.bitLength()+7>>3;if(a<c.length+11)alert("Message too long for RSA"),a=null;else{for(var b=[],d=c.length-1;0<=d&&0<a;){var k=c.charCodeAt(d--);128>k?b[--a]=k:127<k&&2048>k?(b[--a]=k&63|128,b[--a]=k>>6|192):(b[--a]=k&63|128,b[--a]=k>>6&63|128,b[--a]=k>>12|224)}b[--a]=0;c=new S;for(d=[];2<a;){for(d[0]=
0;0==d[0];)c.nextBytes(d);b[--a]=d[0]}b[--a]=2;b[--a]=0;a=new h(b)}if(null==a)return null;a=this.doPublic(a);if(null==a)return null;a=a.toString(16);return 0==(a.length&1)?a:"0"+a};e.prototype.encrypt_b64=function(c){if(c=this.encrypt(c)){var a,b,d="";for(a=0;a+3<=c.length;a+=3)b=parseInt(c.substring(a,a+3),16),d+=P.charAt(b>>6)+P.charAt(b&63);a+1==c.length?(b=parseInt(c.substring(a,a+1),16),d+=P.charAt(b<<2)):a+2==c.length&&(b=parseInt(c.substring(a,a+2),16),d+=P.charAt(b>>2)+P.charAt((b&3)<<4));
for(;0<(d.length&3);)d+=aa;return d}return null};var P="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",aa="\x3d",z;"Microsoft Internet Explorer"==navigator.appName?(h.prototype.am=t,z=30):"Netscape"!=navigator.appName?(h.prototype.am=q,z=26):(h.prototype.am=C,z=28);h.prototype.DB=z;h.prototype.DM=(1<<z)-1;h.prototype.DV=1<<z;h.prototype.FV=Math.pow(2,52);h.prototype.F1=52-z;h.prototype.F2=2*z-52;var Q=[],A;z=48;for(A=0;9>=A;++A)Q[z++]=A;z=97;for(A=10;36>A;++A)Q[z++]=A;z=65;for(A=
10;36>A;++A)Q[z++]=A;H.prototype.convert=function(c){return 0>c.s||0<=c.compareTo(this.m)?c.mod(this.m):c};H.prototype.revert=function(c){return c};H.prototype.reduce=function(c){c.divRemTo(this.m,null,c)};H.prototype.mulTo=function(c,a,b){c.multiplyTo(a,b);this.reduce(b)};H.prototype.sqrTo=function(c,a){c.squareTo(a);this.reduce(a)};E.prototype.convert=function(c){var a=m();c.abs().dlShiftTo(this.m.t,a);a.divRemTo(this.m,null,a);0>c.s&&0<a.compareTo(h.ZERO)&&this.m.subTo(a,a);return a};E.prototype.revert=
function(c){var a=m();c.copyTo(a);this.reduce(a);return a};E.prototype.reduce=function(c){for(;c.t<=this.mt2;)c[c.t++]=0;for(var a=0;a<this.m.t;++a){var b=c[a]&32767,d=b*this.mpl+((b*this.mph+(c[a]>>15)*this.mpl&this.um)<<15)&c.DM,b=a+this.m.t;for(c[b]+=this.m.am(0,d,c,a,0,this.m.t);c[b]>=c.DV;)c[b]-=c.DV,c[++b]++}c.clamp();c.drShiftTo(this.m.t,c);0<=c.compareTo(this.m)&&c.subTo(this.m,c)};E.prototype.mulTo=function(c,a,b){c.multiplyTo(a,b);this.reduce(b)};E.prototype.sqrTo=function(c,a){c.squareTo(a);
this.reduce(a)};h.prototype.copyTo=function(c){for(var a=this.t-1;0<=a;--a)c[a]=this[a];c.t=this.t;c.s=this.s};h.prototype.fromInt=function(c){this.t=1;this.s=0>c?-1:0;0<c?this[0]=c:-1>c?this[0]=c+this.DV:this.t=0};h.prototype.fromString=function(c,a){var b;if(16==a)b=4;else if(8==a)b=3;else if(256==a)b=8;else if(2==a)b=1;else if(32==a)b=5;else if(4==a)b=2;else{this.fromRadix(c,a);return}this.s=this.t=0;for(var d=c.length,k=!1,e=0;0<=--d;){var f;8==b?f=c[d]&255:(f=Q[c.charCodeAt(d)],f=null==f?-1:
f);0>f?"-"==c.charAt(d)&&(k=!0):(k=!1,0==e?this[this.t++]=f:e+b>this.DB?(this[this.t-1]|=(f&(1<<this.DB-e)-1)<<e,this[this.t++]=f>>this.DB-e):this[this.t-1]|=f<<e,e+=b,e>=this.DB&&(e-=this.DB))}8==b&&0!=(c[0]&128)&&(this.s=-1,0<e&&(this[this.t-1]|=(1<<this.DB-e)-1<<e));this.clamp();k&&h.ZERO.subTo(this,this)};h.prototype.clamp=function(){for(var c=this.s&this.DM;0<this.t&&this[this.t-1]==c;)--this.t};h.prototype.dlShiftTo=function(c,a){var b;for(b=this.t-1;0<=b;--b)a[b+c]=this[b];for(b=c-1;0<=b;--b)a[b]=
0;a.t=this.t+c;a.s=this.s};h.prototype.drShiftTo=function(c,a){for(var b=c;b<this.t;++b)a[b-c]=this[b];a.t=Math.max(this.t-c,0);a.s=this.s};h.prototype.lShiftTo=function(c,a){var b=c%this.DB,d=this.DB-b,k=(1<<d)-1,e=Math.floor(c/this.DB),f=this.s<<b&this.DM,g;for(g=this.t-1;0<=g;--g)a[g+e+1]=this[g]>>d|f,f=(this[g]&k)<<b;for(g=e-1;0<=g;--g)a[g]=0;a[e]=f;a.t=this.t+e+1;a.s=this.s;a.clamp()};h.prototype.rShiftTo=function(c,a){a.s=this.s;var b=Math.floor(c/this.DB);if(b>=this.t)a.t=0;else{var d=c%this.DB,
k=this.DB-d,e=(1<<d)-1;a[0]=this[b]>>d;for(var f=b+1;f<this.t;++f)a[f-b-1]|=(this[f]&e)<<k,a[f-b]=this[f]>>d;0<d&&(a[this.t-b-1]|=(this.s&e)<<k);a.t=this.t-b;a.clamp()}};h.prototype.subTo=function(c,a){for(var b=0,d=0,k=Math.min(c.t,this.t);b<k;)d+=this[b]-c[b],a[b++]=d&this.DM,d>>=this.DB;if(c.t<this.t){for(d-=c.s;b<this.t;)d+=this[b],a[b++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;b<c.t;)d-=c[b],a[b++]=d&this.DM,d>>=this.DB;d-=c.s}a.s=0>d?-1:0;-1>d?a[b++]=this.DV+d:0<d&&(a[b++]=d);a.t=
b;a.clamp()};h.prototype.multiplyTo=function(c,a){var b=this.abs(),d=c.abs(),k=b.t;for(a.t=k+d.t;0<=--k;)a[k]=0;for(k=0;k<d.t;++k)a[k+b.t]=b.am(0,d[k],a,k,0,b.t);a.s=0;a.clamp();this.s!=c.s&&h.ZERO.subTo(a,a)};h.prototype.squareTo=function(c){for(var a=this.abs(),b=c.t=2*a.t;0<=--b;)c[b]=0;for(b=0;b<a.t-1;++b){var d=a.am(b,a[b],c,2*b,0,1);(c[b+a.t]+=a.am(b+1,2*a[b],c,2*b+1,d,a.t-b-1))>=a.DV&&(c[b+a.t]-=a.DV,c[b+a.t+1]=1)}0<c.t&&(c[c.t-1]+=a.am(b,a[b],c,2*b,0,1));c.s=0;c.clamp()};h.prototype.divRemTo=
function(c,a,b){var d=c.abs();if(!(0>=d.t)){var k=this.abs();if(k.t<d.t)null!=a&&a.fromInt(0),null!=b&&this.copyTo(b);else{null==b&&(b=m());var e=m(),f=this.s;c=c.s;var g=this.DB-G(d[d.t-1]);0<g?(d.lShiftTo(g,e),k.lShiftTo(g,b)):(d.copyTo(e),k.copyTo(b));d=e.t;k=e[d-1];if(0!=k){var n=k*(1<<this.F1)+(1<d?e[d-2]>>this.F2:0),p=this.FV/n,n=(1<<this.F1)/n,q=1<<this.F2,r=b.t,s=r-d,t=null==a?m():a;e.dlShiftTo(s,t);0<=b.compareTo(t)&&(b[b.t++]=1,b.subTo(t,b));h.ONE.dlShiftTo(d,t);for(t.subTo(e,e);e.t<d;)e[e.t++]=
0;for(;0<=--s;){var u=b[--r]==k?this.DM:Math.floor(b[r]*p+(b[r-1]+q)*n);if((b[r]+=e.am(0,u,b,s,0,d))<u)for(e.dlShiftTo(s,t),b.subTo(t,b);b[r]<--u;)b.subTo(t,b)}null!=a&&(b.drShiftTo(d,a),f!=c&&h.ZERO.subTo(a,a));b.t=d;b.clamp();0<g&&b.rShiftTo(g,b);0>f&&h.ZERO.subTo(b,b)}}}};h.prototype.invDigit=function(){if(1>this.t)return 0;var c=this[0];if(0==(c&1))return 0;var a=c&3,a=a*(2-(c&15)*a)&15,a=a*(2-(c&255)*a)&255,a=a*(2-((c&65535)*a&65535))&65535,a=a*(2-c*a%this.DV)%this.DV;return 0<a?this.DV-a:-a};
h.prototype.isEven=function(){return 0==(0<this.t?this[0]&1:this.s)};h.prototype.exp=function(c,a){if(4294967295<c||1>c)return h.ONE;var b=m(),d=m(),e=a.convert(this),l=G(c)-1;for(e.copyTo(b);0<=--l;)if(a.sqrTo(b,d),0<(c&1<<l))a.mulTo(d,e,b);else var f=b,b=d,d=f;return a.revert(b)};h.prototype.toString=function(c){if(0>this.s)return"-"+this.negate().toString(c);if(16==c)c=4;else if(8==c)c=3;else if(2==c)c=1;else if(32==c)c=5;else if(4==c)c=2;else return this.toRadix(c);var a=(1<<c)-1,b,d=!1,e="",
l=this.t,f=this.DB-l*this.DB%c;if(0<l--)for(f<this.DB&&0<(b=this[l]>>f)&&(d=!0,e="0123456789abcdefghijklmnopqrstuvwxyz".charAt(b));0<=l;)f<c?(b=(this[l]&(1<<f)-1)<<c-f,b|=this[--l]>>(f+=this.DB-c)):(b=this[l]>>(f-=c)&a,0>=f&&(f+=this.DB,--l)),0<b&&(d=!0),d&&(e+="0123456789abcdefghijklmnopqrstuvwxyz".charAt(b));return d?e:"0"};h.prototype.negate=function(){var c=m();h.ZERO.subTo(this,c);return c};h.prototype.abs=function(){return 0>this.s?this.negate():this};h.prototype.compareTo=function(c){var a=
this.s-c.s;if(0!=a)return a;var b=this.t,a=b-c.t;if(0!=a)return 0>this.s?-a:a;for(;0<=--b;)if(0!=(a=this[b]-c[b]))return a;return 0};h.prototype.bitLength=function(){return 0>=this.t?0:this.DB*(this.t-1)+G(this[this.t-1]^this.s&this.DM)};h.prototype.mod=function(c){var a=m();this.abs().divRemTo(c,null,a);0>this.s&&0<a.compareTo(h.ZERO)&&c.subTo(a,a);return a};h.prototype.modPowInt=function(c,a){var b;b=256>c||a.isEven()?new H(a):new E(a);return this.exp(c,b)};h.ZERO=I(0);h.ONE=I(1);var R,y,u;if(null==
y){y=[];u=0;var r;try{if(window.crypto&&window.crypto.getRandomValues){var D=new Uint8Array(32);window.crypto.getRandomValues(D);for(r=0;32>r;++r)y[u++]=D[r]}else if(window.msCrypto&&window.msCrypto.getRandomValues)for(D=new Uint8Array(32),window.msCrypto.getRandomValues(D),r=0;32>r;++r)y[u++]=D[r];else if(window.crypto&&window.crypto.random)for(w=window.crypto.random(32),r=0;r<w.length;++r)y[u++]=w.charCodeAt(r)&255}catch(ia){}for(;u<p;)r=Math.floor(65536*Math.random()),y[u++]=r>>>8,y[u++]=r&255;
u=0;J((new Date).getTime())}S.prototype.nextBytes=function(c){var a;for(a=0;a<c.length;++a){var b=a,d;if(null==R){J((new Date).getTime());R=new T;R.init(y);for(u=0;u<y.length;++u)y[u]=0;u=0}d=R.next();c[b]=d}};(function(){function c(a,b){return this.slice(a,b)}function a(a,b){2>arguments.length&&(b=0);for(var c=0,d=a.length;c<d;++c,++b)this[b]=a[c]&255}function b(b){var d;if("number"===typeof b){d=Array(b);for(var e=0;e<b;++e)d[e]=0}else d=b.slice(0);d.subarray=c;d.buffer=d;d.byteLength=d.length;
d.set=a;"object"===typeof b&&b.buffer&&(d.buffer=b.buffer);return d}try{new Uint8Array(1);new Uint32Array(1);new Int32Array(1);return}catch(d){}try{window.Uint8Array=b}catch(e){}try{window.Uint32Array=b}catch(l){}try{window.Int32Array=b}catch(f){}})();(function(){if(!("response"in XMLHttpRequest.prototype||"mozResponseArrayBuffer"in XMLHttpRequest.prototype||"mozResponse"in XMLHttpRequest.prototype||"responseArrayBuffer"in XMLHttpRequest.prototype))try{Object.defineProperty(XMLHttpRequest.prototype,
"response",{get:function(){return new Uint8Array((new VBArray(this.responseBody)).toArray())}})}catch(c){}})();(function(){"btoa"in window||(window.btoa=function(c){var a="",b,d;b=0;for(d=c.length;b<d;b+=3)var e=c.charCodeAt(b)&255,l=c.charCodeAt(b+1)&255,f=c.charCodeAt(b+2)&255,g=(e&3)<<4|l>>4,l=b+1<d?(l&15)<<2|f>>6:64,f=b+2<d?f&63:64,a=a+("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(e>>2)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(g)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(l)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(f));return a})})();"object"!==typeof JSON&&(JSON={});(function(){function c(a){return 10>a?"0"+a:a}function a(a){e.lastIndex=0;return e.test(a)?'"'+a.replace(e,function(a){var b=g[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function b(c,d){var e,k,g,n,m=l,p,q=d[c];q&&"object"===typeof q&&
"function"===typeof q.toJSON&&(q=q.toJSON(c));"function"===typeof h&&(q=h.call(d,c,q));switch(typeof q){case "string":return a(q);case "number":return isFinite(q)?String(q):"null";case "boolean":case "null":return String(q);case "object":if(!q)return"null";l+=f;p=[];if("[object Array]"===Object.prototype.toString.apply(q)){n=q.length;for(e=0;e<n;e+=1)p[e]=b(e,q)||"null";g=0===p.length?"[]":l?"[\n"+l+p.join(",\n"+l)+"\n"+m+"]":"["+p.join(",")+"]";l=m;return g}if(h&&"object"===typeof h)for(n=h.length,
e=0;e<n;e+=1)"string"===typeof h[e]&&(k=h[e],(g=b(k,q))&&p.push(a(k)+(l?": ":":")+g));else for(k in q)Object.prototype.hasOwnProperty.call(q,k)&&(g=b(k,q))&&p.push(a(k)+(l?": ":":")+g);g=0===p.length?"{}":l?"{\n"+l+p.join(",\n"+l)+"\n"+m+"}":"{"+p.join(",")+"}";l=m;return g}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+c(this.getUTCMonth()+1)+"-"+c(this.getUTCDate())+"T"+c(this.getUTCHours())+":"+c(this.getUTCMinutes())+
":"+c(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,l,f,g={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},h;"function"!==typeof JSON.stringify&&
(JSON.stringify=function(a,c,d){var e;f=l="";if("number"===typeof d)for(e=0;e<d;e+=1)f+=" ";else"string"===typeof d&&(f=d);if((h=c)&&"function"!==typeof c&&("object"!==typeof c||"number"!==typeof c.length))throw Error("JSON.stringify");return b("",{"":a})});"function"!==typeof JSON.parse&&(JSON.parse=function(a,b){function c(a,d){var e,k,f=a[d];if(f&&"object"===typeof f)for(e in f)Object.prototype.hasOwnProperty.call(f,e)&&(k=c(f,e),void 0!==k?f[e]=k:delete f[e]);return b.call(a,d,f)}var e;a=String(a);
d.lastIndex=0;d.test(a)&&(a=a.replace(d,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return e=eval("("+a+")"),"function"===typeof b?c({"":e},""):e;throw new SyntaxError("JSON.parse");})})();T.prototype.init=function(c){var a,b,d;for(a=0;256>a;++a)this.S[a]=a;for(a=b=0;256>a;++a)b=
b+this.S[a]+c[a%c.length]&255,d=this.S[a],this.S[a]=this.S[b],this.S[b]=d;this.j=this.i=0};T.prototype.next=function(){var c;this.i=this.i+1&255;this.j=this.j+this.S[this.i]&255;c=this.S[this.i];this.S[this.i]=this.S[this.j];this.S[this.j]=c;return this.S[c+this.S[this.i]&255]};var p=256;"use strict";r=void 0;var n={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(c){this.toString=function(){return"CORRUPT: "+this.message};this.message=c},invalid:function(c){this.toString=
function(){return"INVALID: "+this.message};this.message=c},bug:function(c){this.toString=function(){return"BUG: "+this.message};this.message=c},notReady:function(c){this.toString=function(){return"NOT READY: "+this.message};this.message=c}}};"undefined"!==typeof module&&module.exports&&(module.exports=n);"function"===typeof define&&define([],function(){return n});n.cipher.aes=function(c){this.k[0][0][0]||this.D();var a,b,d,e,l=this.k[0][4],f=this.k[1];a=c.length;var g=1;4!==a&&6!==a&&8!==a&&x(new n.exception.invalid("invalid aes key size"));
this.b=[d=c.slice(0),e=[]];for(c=a;c<4*a+28;c++){b=d[c-1];if(0===c%a||8===a&&4===c%a)b=l[b>>>24]<<24^l[b>>16&255]<<16^l[b>>8&255]<<8^l[b&255],0===c%a&&(b=b<<8^b>>>24^g<<24,g=g<<1^283*(g>>7));d[c]=d[c-a]^b}for(a=0;c;a++,c--)b=d[a&3?c:c-4],e[a]=4>=c||4>a?b:f[0][l[b>>>24]]^f[1][l[b>>16&255]]^f[2][l[b>>8&255]]^f[3][l[b&255]]};n.cipher.aes.prototype={encrypt:function(c){return M(this,c,0)},decrypt:function(c){return M(this,c,1)},k:[[[],[],[],[],[]],[[],[],[],[],[]]],D:function(){var c=this.k[0],a=this.k[1],
b=c[4],d=a[4],e,l,f,g=[],h=[],n,m,p,q;for(e=0;256>e;e++)h[(g[e]=e<<1^283*(e>>7))^e]=e;for(l=f=0;!b[l];l^=n||1,f=h[f]||1)for(p=f^f<<1^f<<2^f<<3^f<<4,p=p>>8^p&255^99,b[l]=p,d[p]=l,m=g[e=g[n=g[l]]],q=16843009*m^65537*e^257*n^16843008*l,m=257*g[p]^16843008*p,e=0;4>e;e++)c[e][l]=m=m<<24^m>>>8,a[e][p]=q=q<<24^q>>>8;for(e=0;5>e;e++)c[e]=c[e].slice(0),a[e]=a[e].slice(0)}};n.bitArray={bitSlice:function(c,a,b){c=n.bitArray.P(c.slice(a/32),32-(a&31)).slice(1);return b===r?c:n.bitArray.clamp(c,b-a)},extract:function(c,
a,b){var d=Math.floor(-a-b&31);return((a+b-1^a)&-32?c[a/32|0]<<32-d^c[a/32+1|0]>>>d:c[a/32|0]>>>d)&(1<<b)-1},concat:function(c,a){if(0===c.length||0===a.length)return c.concat(a);var b=c[c.length-1],d=n.bitArray.getPartial(b);return 32===d?c.concat(a):n.bitArray.P(a,d,b|0,c.slice(0,c.length-1))},bitLength:function(c){var a=c.length;return 0===a?0:32*(a-1)+n.bitArray.getPartial(c[a-1])},clamp:function(c,a){if(32*c.length<a)return c;c=c.slice(0,Math.ceil(a/32));var b=c.length;a&=31;0<b&&a&&(c[b-1]=
n.bitArray.partial(a,c[b-1]&2147483648>>a-1,1));return c},partial:function(c,a,b){return 32===c?a:(b?a|0:a<<32-c)+1099511627776*c},getPartial:function(c){return Math.round(c/1099511627776)||32},equal:function(c,a){if(n.bitArray.bitLength(c)!==n.bitArray.bitLength(a))return!1;var b=0,d;for(d=0;d<c.length;d++)b|=c[d]^a[d];return 0===b},P:function(c,a,b,d){var e;for(d===r&&(d=[]);32<=a;a-=32)d.push(b),b=0;if(0===a)return d.concat(c);for(e=0;e<c.length;e++)d.push(b|c[e]>>>a),b=c[e]<<32-a;e=c.length?c[c.length-
1]:0;c=n.bitArray.getPartial(e);d.push(n.bitArray.partial(a+c&31,32<a+c?b:d.pop(),1));return d},l:function(c,a){return[c[0]^a[0],c[1]^a[1],c[2]^a[2],c[3]^a[3]]},byteswapM:function(c){var a,b;for(a=0;a<c.length;++a)b=c[a],c[a]=b>>>24|b>>>8&65280|(b&65280)<<8|b<<24;return c}};n.codec.utf8String={fromBits:function(c){var a="",b=n.bitArray.bitLength(c),d,e;for(d=0;d<b/8;d++)0===(d&3)&&(e=c[d/4]),a+=String.fromCharCode(e>>>24),e<<=8;return decodeURIComponent(escape(a))},toBits:function(c){c=unescape(encodeURIComponent(c));
var a=[],b,d=0;for(b=0;b<c.length;b++)d=d<<8|c.charCodeAt(b),3===(b&3)&&(a.push(d),d=0);b&3&&a.push(n.bitArray.partial(8*(b&3),d));return a}};n.codec.hex={fromBits:function(c){var a="",b;for(b=0;b<c.length;b++)a+=((c[b]|0)+0xf00000000000).toString(16).substr(4);return a.substr(0,n.bitArray.bitLength(c)/4)},toBits:function(c){var a,b=[],d;c=c.replace(/\s|0x/g,"");d=c.length;c+="00000000";for(a=0;a<c.length;a+=8)b.push(parseInt(c.substr(a,8),16)^0);return n.bitArray.clamp(b,4*d)}};n.codec.base64={J:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",
fromBits:function(c,a,b){var d="",e=0,l=n.codec.base64.J,f=0,g=n.bitArray.bitLength(c);b&&(l=l.substr(0,62)+"-_");for(b=0;6*d.length<g;)d+=l.charAt((f^c[b]>>>e)>>>26),6>e?(f=c[b]<<6-e,e+=26,b++):(f<<=6,e-=6);for(;d.length&3&&!a;)d+="\x3d";return d},toBits:function(c,a){c=c.replace(/\s|=/g,"");var b=[],d,e=0,l=n.codec.base64.J,f=0,g;a&&(l=l.substr(0,62)+"-_");for(d=0;d<c.length;d++)g=l.indexOf(c.charAt(d)),0>g&&x(new n.exception.invalid("this isn't base64!")),26<e?(e-=26,b.push(f^g>>>e),f=g<<32-e):
(e+=6,f^=g<<32-e);e&56&&b.push(n.bitArray.partial(e&56,f,1));return b}};n.codec.base64url={fromBits:function(c){return n.codec.base64.fromBits(c,1,1)},toBits:function(c){return n.codec.base64.toBits(c,1)}};n.hash.sha256=function(c){this.b[0]||this.D();c?(this.r=c.r.slice(0),this.o=c.o.slice(0),this.h=c.h):this.reset()};n.hash.sha256.hash=function(c){return(new n.hash.sha256).update(c).finalize()};n.hash.sha256.prototype={blockSize:512,reset:function(){this.r=this.N.slice(0);this.o=[];this.h=0;return this},
update:function(c){"string"===typeof c&&(c=n.codec.utf8String.toBits(c));var a,b=this.o=n.bitArray.concat(this.o,c);a=this.h;c=this.h=a+n.bitArray.bitLength(c);for(a=512+a&-512;a<=c;a+=512)w(this,b.splice(0,16));return this},finalize:function(){var c,a=this.o,b=this.r,a=n.bitArray.concat(a,[n.bitArray.partial(1,1)]);for(c=a.length+2;c&15;c++)a.push(0);a.push(Math.floor(this.h/4294967296));for(a.push(this.h|0);a.length;)w(this,a.splice(0,16));this.reset();return b},N:[],b:[],D:function(){function c(a){return 4294967296*
(a-Math.floor(a))|0}var a=0,b=2,d;a:for(;64>a;b++){for(d=2;d*d<=b;d++)if(0===b%d)continue a;8>a&&(this.N[a]=c(Math.pow(b,.5)));this.b[a]=c(Math.pow(b,1/3));a++}}};n.mode.ccm={name:"ccm",encrypt:function(c,a,b,d,e){var l,f=a.slice(0),g=n.bitArray,h=g.bitLength(b)/8,m=g.bitLength(f)/8;e=e||64;d=d||[];7>h&&x(new n.exception.invalid("ccm: iv must be at least 7 bytes"));for(l=2;4>l&&m>>>8*l;l++);l<15-h&&(l=15-h);b=g.clamp(b,8*(15-l));a=n.mode.ccm.L(c,a,b,d,e,l);f=n.mode.ccm.p(c,f,b,a,e,l);return g.concat(f.data,
f.tag)},decrypt:function(c,a,b,d,e){e=e||64;d=d||[];var l=n.bitArray,f=l.bitLength(b)/8,g=l.bitLength(a),h=l.clamp(a,g-e),m=l.bitSlice(a,g-e),g=(g-e)/8;7>f&&x(new n.exception.invalid("ccm: iv must be at least 7 bytes"));for(a=2;4>a&&g>>>8*a;a++);a<15-f&&(a=15-f);b=l.clamp(b,8*(15-a));h=n.mode.ccm.p(c,h,b,m,e,a);c=n.mode.ccm.L(c,h.data,b,d,e,a);l.equal(h.tag,c)||x(new n.exception.corrupt("ccm: tag doesn't match"));return h.data},L:function(c,a,b,d,e,l){var f=[],g=n.bitArray,h=g.l;e/=8;(e%2||4>e||16<
e)&&x(new n.exception.invalid("ccm: invalid tag length"));(4294967295<d.length||4294967295<a.length)&&x(new n.exception.bug("ccm: can't deal with 4GiB or more data"));l=[g.partial(8,(d.length?64:0)|e-2<<2|l-1)];l=g.concat(l,b);l[3]|=g.bitLength(a)/8;l=c.encrypt(l);if(d.length)for(b=g.bitLength(d)/8,65279>=b?f=[g.partial(16,b)]:4294967295>=b&&(f=g.concat([g.partial(16,65534)],[b])),f=g.concat(f,d),d=0;d<f.length;d+=4)l=c.encrypt(h(l,f.slice(d,d+4).concat([0,0,0])));for(d=0;d<a.length;d+=4)l=c.encrypt(h(l,
a.slice(d,d+4).concat([0,0,0])));return g.clamp(l,8*e)},p:function(c,a,b,d,e,l){var f,g=n.bitArray;f=g.l;var h=a.length,m=g.bitLength(a);b=g.concat([g.partial(8,l-1)],b).concat([0,0,0]).slice(0,4);d=g.bitSlice(f(d,c.encrypt(b)),0,e);if(!h)return{tag:d,data:[]};for(f=0;f<h;f+=4)b[3]++,e=c.encrypt(b),a[f]^=e[0],a[f+1]^=e[1],a[f+2]^=e[2],a[f+3]^=e[3];return{tag:d,data:g.clamp(a,m)}}};n.mode.ocb2={name:"ocb2",encrypt:function(c,a,b,d,e,l){128!==n.bitArray.bitLength(b)&&x(new n.exception.invalid("ocb iv must be 128 bits"));
var f,g=n.mode.ocb2.H,h=n.bitArray,m=h.l,p=[0,0,0,0];b=g(c.encrypt(b));var q,r=[];d=d||[];e=e||64;for(f=0;f+4<a.length;f+=4)q=a.slice(f,f+4),p=m(p,q),r=r.concat(m(b,c.encrypt(m(b,q)))),b=g(b);q=a.slice(f);a=h.bitLength(q);f=c.encrypt(m(b,[0,0,0,a]));q=h.clamp(m(q.concat([0,0,0]),f),a);p=m(p,m(q.concat([0,0,0]),f));p=c.encrypt(m(p,m(b,g(b))));d.length&&(p=m(p,l?d:n.mode.ocb2.pmac(c,d)));return r.concat(h.concat(q,h.clamp(p,e)))},decrypt:function(c,a,b,d,e,l){128!==n.bitArray.bitLength(b)&&x(new n.exception.invalid("ocb iv must be 128 bits"));
e=e||64;var f=n.mode.ocb2.H,g=n.bitArray,h=g.l,m=[0,0,0,0],p=f(c.encrypt(b)),q,r,s=n.bitArray.bitLength(a)-e,t=[];d=d||[];for(b=0;b+4<s/32;b+=4)q=h(p,c.decrypt(h(p,a.slice(b,b+4)))),m=h(m,q),t=t.concat(q),p=f(p);r=s-32*b;q=c.encrypt(h(p,[0,0,0,r]));q=h(q,g.clamp(a.slice(b),r).concat([0,0,0]));m=h(m,q);m=c.encrypt(h(m,h(p,f(p))));d.length&&(m=h(m,l?d:n.mode.ocb2.pmac(c,d)));g.equal(g.clamp(m,e),g.bitSlice(a,s))||x(new n.exception.corrupt("ocb: tag doesn't match"));return t.concat(g.clamp(q,r))},pmac:function(c,
a){var b,d=n.mode.ocb2.H,e=n.bitArray,l=e.l,f=[0,0,0,0],g=c.encrypt([0,0,0,0]),g=l(g,d(d(g)));for(b=0;b+4<a.length;b+=4)g=d(g),f=l(f,c.encrypt(l(g,a.slice(b,b+4))));b=a.slice(b);128>e.bitLength(b)&&(g=l(g,d(g)),b=e.concat(b,[-2147483648,0,0,0]));f=l(f,b);return c.encrypt(l(d(l(g,d(g))),f))},H:function(c){return[c[0]<<1^c[1]>>>31,c[1]<<1^c[2]>>>31,c[2]<<1^c[3]>>>31,c[3]<<1^135*(c[0]>>>31)]}};n.mode.gcm={name:"gcm",encrypt:function(c,a,b,d,e){var l=a.slice(0);a=n.bitArray;d=d||[];c=n.mode.gcm.p(!0,
c,l,d,b,e||128);return a.concat(c.data,c.tag)},decrypt:function(c,a,b,d,e){var l=a.slice(0),f=n.bitArray,g=f.bitLength(l);e=e||128;d=d||[];e<=g?(a=f.bitSlice(l,g-e),l=f.bitSlice(l,0,g-e)):(a=l,l=[]);c=n.mode.gcm.p(!1,c,l,d,b,e);f.equal(c.tag,a)||x(new n.exception.corrupt("gcm: tag doesn't match"));return c.data},Z:function(c,a){var b,d,e,l,f,g=n.bitArray.l;e=[0,0,0,0];l=a.slice(0);for(b=0;128>b;b++){0!==(c[Math.floor(b/32)]&1<<31-b%32)&&(e=g(e,l));f=0!==(l[3]&1);for(d=3;0<d;d--)l[d]=l[d]>>>1|(l[d-
1]&1)<<31;l[0]>>>=1;f&&(l[0]^=-520093696)}return e},g:function(c,a,b){var d,e=b.length;a=a.slice(0);for(d=0;d<e;d+=4)a[0]^=4294967295&b[d],a[1]^=4294967295&b[d+1],a[2]^=4294967295&b[d+2],a[3]^=4294967295&b[d+3],a=n.mode.gcm.Z(a,c);return a},p:function(c,a,b,d,e,l){var f,g,h,m,p,q,r,s,t=n.bitArray;q=b.length;r=t.bitLength(b);s=t.bitLength(d);g=t.bitLength(e);f=a.encrypt([0,0,0,0]);96===g?(e=e.slice(0),e=t.concat(e,[1])):(e=n.mode.gcm.g(f,[0,0,0,0],e),e=n.mode.gcm.g(f,e,[0,0,Math.floor(g/4294967296),
g&4294967295]));g=n.mode.gcm.g(f,[0,0,0,0],d);p=e.slice(0);d=g.slice(0);c||(d=n.mode.gcm.g(f,g,b));for(m=0;m<q;m+=4)p[3]++,h=a.encrypt(p),b[m]^=h[0],b[m+1]^=h[1],b[m+2]^=h[2],b[m+3]^=h[3];b=t.clamp(b,r);c&&(d=n.mode.gcm.g(f,g,b));c=[Math.floor(s/4294967296),s&4294967295,Math.floor(r/4294967296),r&4294967295];d=n.mode.gcm.g(f,d,c);h=a.encrypt(e);d[0]^=h[0];d[1]^=h[1];d[2]^=h[2];d[3]^=h[3];return{tag:t.bitSlice(d,0,l),data:b}}};n.misc.hmac=function(c,a){this.M=a=a||n.hash.sha256;var b=[[],[]],d,e=a.prototype.blockSize/
32;this.n=[new a,new a];c.length>e&&(c=a.hash(c));for(d=0;d<e;d++)b[0][d]=c[d]^909522486,b[1][d]=c[d]^1549556828;this.n[0].update(b[0]);this.n[1].update(b[1]);this.G=new a(this.n[0])};n.misc.hmac.prototype.encrypt=n.misc.hmac.prototype.mac=function(c){this.Q&&x(new n.exception.invalid("encrypt on already updated hmac called!"));this.update(c);return this.digest(c)};n.misc.hmac.prototype.reset=function(){this.G=new this.M(this.n[0]);this.Q=!1};n.misc.hmac.prototype.update=function(c){this.Q=!0;this.G.update(c)};
n.misc.hmac.prototype.digest=function(){var c=this.G.finalize(),c=(new this.M(this.n[1])).update(c).finalize();this.reset();return c};n.misc.pbkdf2=function(c,a,b,d,e){b=b||1E3;(0>d||0>b)&&x(n.exception.invalid("invalid params to pbkdf2"));"string"===typeof c&&(c=n.codec.utf8String.toBits(c));"string"===typeof a&&(a=n.codec.utf8String.toBits(a));e=e||n.misc.hmac;c=new e(c);var h,f,g,m,p=[],q=n.bitArray;for(m=1;32*p.length<(d||1);m++){e=h=c.encrypt(q.concat(a,[m]));for(f=1;f<b;f++)for(h=c.encrypt(h),
g=0;g<h.length;g++)e[g]^=h[g];p=p.concat(e)}d&&(p=q.clamp(p,d));return p};n.prng=function(c){this.c=[new n.hash.sha256];this.i=[0];this.F=0;this.s={};this.C=0;this.K={};this.O=this.d=this.j=this.W=0;this.b=[0,0,0,0,0,0,0,0];this.f=[0,0,0,0];this.A=r;this.B=c;this.q=!1;this.w={progress:{},seeded:{}};this.m=this.V=0;this.t=1;this.u=2;this.S=65536;this.I=[0,48,64,96,128,192,256,384,512,768,1024];this.T=3E4;this.R=80};n.prng.prototype={randomWords:function(c,a){var b=[],d;d=this.isReady(a);var e;d===
this.m&&x(new n.exception.notReady("generator isn't seeded"));if(d&this.u){d=!(d&this.t);e=[];var h=0,f;this.O=e[0]=(new Date).valueOf()+this.T;for(f=0;16>f;f++)e.push(4294967296*Math.random()|0);for(f=0;f<this.c.length&&(e=e.concat(this.c[f].finalize()),h+=this.i[f],this.i[f]=0,d||!(this.F&1<<f));f++);this.F>=1<<this.c.length&&(this.c.push(new n.hash.sha256),this.i.push(0));this.d-=h;h>this.j&&(this.j=h);this.F++;this.b=n.hash.sha256.hash(this.b.concat(e));this.A=new n.cipher.aes(this.b);for(d=0;4>
d&&(this.f[d]=this.f[d]+1|0,!this.f[d]);d++);}for(d=0;d<c;d+=4)0===(d+1)%this.S&&ca(this),e=U(this),b.push(e[0],e[1],e[2],e[3]);ca(this);return b.slice(0,c)},setDefaultParanoia:function(c,a){0===c&&"Setting paranoia\x3d0 will ruin your security; use it only for testing"!==a&&x("Setting paranoia\x3d0 will ruin your security; use it only for testing");this.B=c},addEntropy:function(c,a,b){b=b||"user";var d,e,h=(new Date).valueOf(),f=this.s[b],g=this.isReady(),m=0;d=this.K[b];d===r&&(d=this.K[b]=this.W++);
f===r&&(f=this.s[b]=0);this.s[b]=(this.s[b]+1)%this.c.length;switch(typeof c){case "number":a===r&&(a=1);this.c[f].update([d,this.C++,1,a,h,1,c|0]);break;case "object":b=Object.prototype.toString.call(c);if("[object Uint32Array]"===b){e=[];for(b=0;b<c.length;b++)e.push(c[b]);c=e}else for("[object Array]"!==b&&(m=1),b=0;b<c.length&&!m;b++)"number"!==typeof c[b]&&(m=1);if(!m){if(a===r)for(b=a=0;b<c.length;b++)for(e=c[b];0<e;)a++,e>>>=1;this.c[f].update([d,this.C++,2,a,h,c.length].concat(c))}break;case "string":a===
r&&(a=c.length);this.c[f].update([d,this.C++,3,a,h,c.length]);this.c[f].update(c);break;default:m=1}m&&x(new n.exception.bug("random: addEntropy only supports number, array of numbers or string"));this.i[f]+=a;this.d+=a;g===this.m&&(this.isReady()!==this.m&&ba("seeded",Math.max(this.j,this.d)),ba("progress",this.getProgress()))},isReady:function(c){c=this.I[c!==r?c:this.B];return this.j&&this.j>=c?this.i[0]>this.R&&(new Date).valueOf()>this.O?this.u|this.t:this.t:this.d>=c?this.u|this.m:this.m},getProgress:function(c){c=
this.I[c?c:this.B];return this.j>=c?1:this.d>c?1:this.d/c},startCollectors:function(){this.q||(this.a={loadTimeCollector:Y(this,this.aa),mouseCollector:Y(this,this.ba),keyboardCollector:Y(this,this.$),accelerometerCollector:Y(this,this.U)},window.addEventListener?(window.addEventListener("load",this.a.loadTimeCollector,!1),window.addEventListener("mousemove",this.a.mouseCollector,!1),window.addEventListener("keypress",this.a.keyboardCollector,!1),window.addEventListener("devicemotion",this.a.accelerometerCollector,
!1)):document.attachEvent?(document.attachEvent("onload",this.a.loadTimeCollector),document.attachEvent("onmousemove",this.a.mouseCollector),document.attachEvent("keypress",this.a.keyboardCollector)):x(new n.exception.bug("can't attach event")),this.q=!0)},stopCollectors:function(){this.q&&(window.removeEventListener?(window.removeEventListener("load",this.a.loadTimeCollector,!1),window.removeEventListener("mousemove",this.a.mouseCollector,!1),window.removeEventListener("keypress",this.a.keyboardCollector,
!1),window.removeEventListener("devicemotion",this.a.accelerometerCollector,!1)):document.detachEvent&&(document.detachEvent("onload",this.a.loadTimeCollector),document.detachEvent("onmousemove",this.a.mouseCollector),document.detachEvent("keypress",this.a.keyboardCollector)),this.q=!1)},addEventListener:function(c,a){this.w[c][this.V++]=a},removeEventListener:function(c,a){var b,d,e=this.w[c],h=[];for(d in e)e.hasOwnProperty(d)&&e[d]===a&&h.push(d);for(b=0;b<h.length;b++)d=h[b],delete e[d]},$:function(){N(1)},
ba:function(c){var a,b;try{a=c.x||c.clientX||c.offsetX||0,b=c.y||c.clientY||c.offsetY||0}catch(d){b=a=0}0!=a&&0!=b&&n.random.addEntropy([a,b],2,"mouse");N(0)},aa:function(){N(2)},U:function(c){c=c.accelerationIncludingGravity.x||c.accelerationIncludingGravity.y||c.accelerationIncludingGravity.z;if(window.orientation){var a=window.orientation;"number"===typeof a&&n.random.addEntropy(a,1,"accelerometer")}c&&n.random.addEntropy(c,2,"accelerometer");N(0)}};n.random=new n.prng(6);a:try{var V,W,X,Z;if(Z=
"undefined"!==typeof module){var $;if($=module.exports){var ga;try{ga=require("crypto")}catch(ha){ga=null}$=(W=ga)&&W.randomBytes}Z=$}if(Z)V=W.randomBytes(128),V=new Uint32Array((new Uint8Array(V)).buffer),n.random.addEntropy(V,1024,"crypto['randomBytes']");else if("undefined"!==typeof window&&"undefined"!==typeof Uint32Array){X=new Uint32Array(32);if(window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(X);else if(window.msCrypto&&window.msCrypto.getRandomValues)window.msCrypto.getRandomValues(X);
else break a;n.random.addEntropy(X,1024,"crypto['getRandomValues']")}}catch(s){"undefined"!==typeof window&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(s))}n.json={defaults:{v:1,iter:1E3,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},Y:function(c,a,b,d){b=b||{};d=d||{};var e=n.json,h=e.e({iv:n.random.randomWords(4,0)},e.defaults),f;e.e(h,b);b=h.adata;"string"===typeof h.salt&&(h.salt=n.codec.base64.toBits(h.salt));"string"===typeof h.iv&&(h.iv=
n.codec.base64.toBits(h.iv));(!n.mode[h.mode]||!n.cipher[h.cipher]||"string"===typeof c&&100>=h.iter||64!==h.ts&&96!==h.ts&&128!==h.ts||128!==h.ks&&192!==h.ks&&256!==h.ks||2>h.iv.length||4<h.iv.length)&&x(new n.exception.invalid("json encrypt: invalid parameters"));"string"===typeof c?(f=n.misc.cachedPbkdf2(c,h),c=f.key.slice(0,h.ks/32),h.salt=f.salt):n.ecc&&c instanceof n.ecc.elGamal.publicKey&&(f=c.kem(),h.kemtag=f.tag,c=f.key.slice(0,h.ks/32));"string"===typeof a&&(a=n.codec.utf8String.toBits(a));
"string"===typeof b&&(b=n.codec.utf8String.toBits(b));f=new n.cipher[h.cipher](c);e.e(d,h);d.key=c;h.ct=n.mode[h.mode].encrypt(f,a,h.iv,b,h.ts);return h},encrypt:function(c,a,b,d){var e=n.json,h=e.Y.apply(e,arguments);return e.encode(h)},X:function(c,a,b,d){b=b||{};d=d||{};var e=n.json;a=e.e(e.e(e.e({},e.defaults),a),b,!0);var h,f;h=a.adata;"string"===typeof a.salt&&(a.salt=n.codec.base64.toBits(a.salt));"string"===typeof a.iv&&(a.iv=n.codec.base64.toBits(a.iv));(!n.mode[a.mode]||!n.cipher[a.cipher]||
"string"===typeof c&&100>=a.iter||64!==a.ts&&96!==a.ts&&128!==a.ts||128!==a.ks&&192!==a.ks&&256!==a.ks||!a.iv||2>a.iv.length||4<a.iv.length)&&x(new n.exception.invalid("json decrypt: invalid parameters"));"string"===typeof c?(f=n.misc.cachedPbkdf2(c,a),c=f.key.slice(0,a.ks/32),a.salt=f.salt):n.ecc&&c instanceof n.ecc.elGamal.secretKey&&(c=c.unkem(n.codec.base64.toBits(a.kemtag)).slice(0,a.ks/32));"string"===typeof h&&(h=n.codec.utf8String.toBits(h));f=new n.cipher[a.cipher](c);h=n.mode[a.mode].decrypt(f,
a.ct,a.iv,h,a.ts);e.e(d,a);d.key=c;return 1===b.raw?h:n.codec.utf8String.fromBits(h)},decrypt:function(c,a,b,d){var e=n.json;return e.X(c,e.decode(a),b,d)},encode:function(c){var a,b="{",d="";for(a in c)if(c.hasOwnProperty(a))switch(a.match(/^[a-z0-9]+$/i)||x(new n.exception.invalid("json encode: invalid property name")),b+=d+'"'+a+'":',d=",",typeof c[a]){case "number":case "boolean":b+=c[a];break;case "string":b+='"'+escape(c[a])+'"';break;case "object":b+='"'+n.codec.base64.fromBits(c[a],0)+'"';
break;default:x(new n.exception.bug("json encode: unsupported type"))}return b+"}"},decode:function(c){c=c.replace(/\s/g,"");c.match(/^\{.*\}$/)||x(new n.exception.invalid("json decode: this isn't json!"));c=c.replace(/^\{|\}$/g,"").split(/,/);var a={},b,d;for(b=0;b<c.length;b++)(d=c[b].match(/^(?:(["']?)([a-z][a-z0-9]*)\1):(?:(\d+)|"([a-z0-9+\/%*_.@=\-]*)")$/i))||x(new n.exception.invalid("json decode: this isn't json!")),a[d[2]]=d[3]?parseInt(d[3],10):d[2].match(/^(ct|salt|iv)$/)?n.codec.base64.toBits(d[4]):
unescape(d[4]);return a},e:function(c,a,b){c===r&&(c={});if(a===r)return c;for(var d in a)a.hasOwnProperty(d)&&(b&&c[d]!==r&&c[d]!==a[d]&&x(new n.exception.invalid("required parameter overridden")),c[d]=a[d]);return c},ea:function(c,a){var b={},d;for(d in c)c.hasOwnProperty(d)&&c[d]!==a[d]&&(b[d]=c[d]);return b},da:function(c,a){var b={},d;for(d=0;d<a.length;d++)c[a[d]]!==r&&(b[a[d]]=c[a[d]]);return b}};n.encrypt=n.json.encrypt;n.decrypt=n.json.decrypt;n.misc.ca={};n.misc.cachedPbkdf2=function(c,
a){var b=n.misc.ca,d;a=a||{};d=a.iter||1E3;b=b[c]=b[c]||{};d=b[d]=b[d]||{firstSalt:a.salt&&a.salt.length?a.salt.slice(0):n.random.randomWords(2,0)};b=a.salt===r?d.firstSalt:a.salt;d[b]=d[b]||n.misc.pbkdf2(c,b,a.iter);return{key:d[b].slice(0),salt:b.slice(0)}};D=window.drwp=window.drwp||{};D=D.encrypt=D.encrypt||{createPaymentForm:function(c,a){return new L(c,a)}};D.errors=D.errors||{};var L=D.PaymentForm=function(c,a){try{n.random.startCollectors()}catch(b){console.log("cannot start sjcl random")}this.key=
c;this.drCompanyId=a;this.validity={}};L.prototype={constructor:L,createRSAKey:function(){var c=this.key.split("|");if(2!=c.length)throw"Malformed public key";var a=c[0],c=c[1],b=new e;b.setPublic(c,a);return b},createAESKey:function(){return new B},encryptPaymentForm:function(c){var a,b,d={};a=this.createRSAKey();b=this.createAESKey();d=b.encrypt(c);keybytes=n.codec.base64url.fromBits(b.key);c=a.encrypt(keybytes);return["DRWP_1.0#",this.drCompanyId,"#",c,"#",d.iv,"#",d.cipher].join("")}};var B=function(){},
O={cipher:null,iv:null};B.prototype={constructor:B,key:n.random.randomWords(8,0),encrypt:function(c){return this.encryptWithInitializationVector(c,n.random.randomWords(4,0))},encryptWithInitializationVector:function(c,a){var b,d;b=new n.cipher.aes(this.key);d=n.codec.utf8String.toBits(c);b=n.mode.gcm.encrypt(b,d,a);O.cipher=n.codec.base64url.fromBits(b);O.iv=n.codec.base64url.fromBits(a);return O}}})();
function AdyenEncrypter(e,h,m,q,t){this._instance=e.createEncryption(h);this._instance.monitor("number",q);this._instance.monitor("cvc",t);this._holderFullname=m}AdyenEncrypter.prototype.encrypt=function(e){return this._instance.encrypt({number:e.number,cvc:e.cvc,expiryMonth:e.expiryMonth,expiryYear:e.expiryYear,holderName:this._holderFullname,generationtime:e.generationtime})};
function DigitalRiverEncrypter(e,h,m,q,t){this._instance=e.createPaymentForm(h,m);this._holderFullname=q+" "+t;this._holderFirstname=q;this._holderLastname=t}DigitalRiverEncrypter.prototype.encrypt=function(e){return this._instance.encryptPaymentForm(JSON.stringify({cardNumber:e.number,expirationYear:e.expiryYear,expirationMonth:e.expiryMonth,cvCode:e.cvc,fullName:this._holderFullname,firstName:this._holderFirstname,lastName:this._holderLastname}))};
function CSE(e){this._providerEncrypterMapping=e}CSE.prototype.encrypt=function(e,h){if(!this._providerEncrypterMapping[e])throw"Unsupported provider: "+e;return this._providerEncrypterMapping[e].encrypt(h)};function CardStore(){}CardStore.DEFAULT_CARD_FORMAT=[4,4,4,4];CardStore.DEFAULT_CARD_LENGTH=16;CardStore.DEFAULT_CVC_LENGTH=3;CardStore.BIN_LENGTH=6;
CardStore.CARDS=[{type:"elo",pattern:/^(40117[89]|431274|438935|451416|457393|45763[12]|627780|636297|636368|504175|5067|509|650[0459]|6516[5-9]|65170[0-4]|6550)/,length:CardStore.DEFAULT_CARD_LENGTH,format:CardStore.DEFAULT_CARD_FORMAT,cvc:CardStore.DEFAULT_CVC_LENGTH},{type:"visa",pattern:/^4/,length:CardStore.DEFAULT_CARD_LENGTH,format:CardStore.DEFAULT_CARD_FORMAT,cvc:CardStore.DEFAULT_CVC_LENGTH},{type:"mastercard",pattern:/^(5[1-5]|222[1-9]|2[3-6]\d{2}|27[0-1]\d|2720|502120|502121)/,length:CardStore.DEFAULT_CARD_LENGTH,
format:CardStore.DEFAULT_CARD_FORMAT,cvc:CardStore.DEFAULT_CVC_LENGTH},{type:"amex",pattern:/^3[47]/,length:15,format:[4,6,5],cvc:4},{type:"discover",pattern:/^6(?:011\d{12}|5\d{14}|4[4-9]\d{13}|22(?:1(?:2[6-9]|[3-9]\d)|[2-8]\d{2}|9(?:[01]\d|2[0-5]))\d{10})/,length:CardStore.DEFAULT_CARD_LENGTH,format:CardStore.DEFAULT_CARD_FORMAT,cvc:CardStore.DEFAULT_CVC_LENGTH},{type:"hiper",pattern:/^(606282|384100|384140|384160)/,length:CardStore.DEFAULT_CARD_LENGTH,format:CardStore.DEFAULT_CARD_FORMAT,cvc:CardStore.DEFAULT_CVC_LENGTH},
{type:"rupay",pattern:/^(60|6521|6522)/,length:CardStore.DEFAULT_CARD_LENGTH,format:CardStore.DEFAULT_CARD_FORMAT,cvc:CardStore.DEFAULT_CVC_LENGTH},{type:"diners",pattern:/^(300|301|302|303|304|305|36|38)/,length:14,format:[4,6,4],cvc:CardStore.DEFAULT_CVC_LENGTH},{type:"jcb_15",pattern:/^(2131|1800)/,length:15,format:CardStore.DEFAULT_CARD_FORMAT,cvc:CardStore.DEFAULT_CVC_LENGTH},{type:"jcb_16",pattern:/^35(?:2[89]|[3-8]\d)/,length:CardStore.DEFAULT_CARD_LENGTH,format:CardStore.DEFAULT_CARD_FORMAT,
cvc:CardStore.DEFAULT_CVC_LENGTH},{type:"aura",pattern:/^50/,length:19,format:[19],cvc:CardStore.DEFAULT_CVC_LENGTH}];CardStore.prototype.getByNumber=function(e){e=this._getCardNumberDigits(e);for(var h=0;h<CardStore.CARDS.length;h++){var m=CardStore.CARDS[h];if(m.pattern.test(e))return m}return null};CardStore.prototype.isValidCvcForCardNumber=function(e,h){if(/^[0-9]*$/.test(e)){var m=this.getByNumber(h);return e.length===(m?m.cvc:CardStore.DEFAULT_CVC_LENGTH)}return!1};
CardStore.prototype.isValidNumber=function(e){if(!e)return!1;e=this._getCardNumberDigits(e);var h=this.getByNumber(e);return h&&h.length===e.length?this._luhnCheck(e):!1};CardStore.prototype.getCardBin=function(e){return this._getCardNumberDigits(e).substr(0,CardStore.BIN_LENGTH)};CardStore.prototype._getCardNumberDigits=function(e){return e.replace(/\D/g,"")};
CardStore.prototype._luhnCheck=function(e){for(var h=0,m=0,q=e.length-1;0<=q;q--){m+=parseInt(e.charAt(q),10);q--;for(var h=String(2*e.charAt(q)),t=0;t<h.length;t++)m+=parseInt(h.charAt(t),10)}return 0==m%10};function CardNumberInput(e,h,m,q){this._el=e;this._cardStore=h;this._cvcInput=m;this._iconSelector=q;this._currentCard=this._createDefaultCard()}
CardNumberInput.prototype.attach=function(){this._el.addEventListener("input",this._onInput.bind(this));this._el.addEventListener("change",this._onInput.bind(this));this._el.addEventListener("keydown",this._handleBackspace.bind(this));this._el.addEventListener("keypress",this._onKeyPress.bind(this),!1)};CardNumberInput.prototype._createDefaultCard=function(){return{type:!1,length:CardStore.DEFAULT_CARD_LENGTH,format:CardStore.DEFAULT_CARD_FORMAT,cvc:CardStore.DEFAULT_CVC_LENGTH}};
CardNumberInput.prototype._getCardByNumber=function(e){return this._cardStore.getByNumber(e)||this._createDefaultCard()};CardNumberInput.prototype._setCurrentCard=function(e){e.type!==this._currentCard.type&&(this._cvcInput.resetMaxLength(e.cvc),this._iconSelector.highlightIcon(e.type),this._currentCard=e)};
CardNumberInput.prototype._onKeyPress=function(e){var h=e.currentTarget,m=String.fromCharCode(e.which||e.charCode||e.keyCode),q=h.value;if(/^\d+$/.test(m)&&!/\s$/.test(q)&&this._isCursorAtEnd(h)){var t=(q.replace(/\D/g,"")+m).length,C=this._getCardByNumber(q+m);t!==C.length&&(t>C.length?e.preventDefault():(C=this._getCutOffs(C.format),-1<C.indexOf(t)?(e.preventDefault(),h.value=q+m+" "):-1<C.indexOf(t-1)&&(e.preventDefault(),h.value=q+" "+m)))}};
CardNumberInput.prototype._onInput=function(e){var h=this._el.value.replace(/\D/g,""),m=this._getCardByNumber(h);this._setCurrentCard(m);if("input"===e.type){var q=this._el;this._isCursorAtEnd()&&setTimeout(function(){q.selectionStart=q.selectionEnd=1E4},0)}this._el.value=this._formatCardNumber(h,m)};
CardNumberInput.prototype._formatCardNumber=function(e,h){var m=this._createRegExpFromFormat(h.format),q=e.substring(0,h.length),m=m.exec(q);null!=m&&(m.shift(),q=m.filter(function(e){return"string"===typeof e}).join(" "));return q};CardNumberInput.prototype._handleBackspace=function(e){if(8===(e.which||e.keyCode||e.charCode)&&this._isCursorAtEnd()){var h=/\d\s$/;h.test(this._el.value)&&(e.preventDefault(),this._el.value=this._el.value.replace(h,""))}};
CardNumberInput.prototype._getCutOffs=function(e){return e.reduce(function(e,m,q){e.push(0<q?m+e[q-1]:m);return e},[]).slice(0,-1)};CardNumberInput.prototype._createRegExpFromFormat=function(e){e=e.map(function(e){return"(\\d{1,"+e+"})"});e=e[0]+e.slice(1).join("?")+"?";return new RegExp(e)};CardNumberInput.prototype._isCursorAtEnd=function(){return this._el.selectionStart===this._el.value.length};function ExpiryDateInput(e){this._el=e}
ExpiryDateInput.prototype.attach=function(){this._el.addEventListener("keydown",this._handleBackspace.bind(this));this._el.addEventListener("input",this._onInput.bind(this))};ExpiryDateInput.prototype._onInput=function(){var e=this._el;this._isCursorAtEnd()&&setTimeout(function(){e.selectionStart=e.selectionEnd=1E4},0);this._el.value=this._format(this._el.value)};
ExpiryDateInput.prototype._handleBackspace=function(e){if(8===(e.which||e.keyCode||e.charCode)&&this._isCursorAtEnd()){var h=/\d\s\/\s$/;h.test(this._el.value)&&(e.preventDefault(),this._el.value=this._el.value.replace(h,""))}};
ExpiryDateInput.prototype._format=function(e){var h=e.match(/^\D*(\d{1,2})(\D+)?(\d{1,2})?/);if(null===h)return"";e=h[1]||"";var m=h[2]||"",h=h[3]||"";0<h.length&&(m=" / ");" /"===m?m="":2===e.length?12>=parseInt(e,10)?m=" / ":e=e.substring(0,1):-1===["0","1"].indexOf(e)?(e="0"+e,m=" / "):m.length&&1===e.length&&(e="0"+e,m=" / ");return e+m+h};ExpiryDateInput.prototype._isCursorAtEnd=function(){return this._el.selectionStart===this._el.value.length};
function CvcInput(e){this._el=e;this._maxLength=3}CvcInput.prototype.attach=function(){this._el.addEventListener("input",this._format.bind(this))};CvcInput.prototype.resetMaxLength=function(e){this._maxLength=e;this._format()};CvcInput.prototype._format=function(){this._el.value=this._el.value.replace(/\D/g,"").substring(0,this._maxLength)};function PostalCodeInput(e){this._el=e}PostalCodeInput.MAX_LENGTH=10;PostalCodeInput.prototype.attach=function(){this._el.addEventListener("input",this._format.bind(this))};
PostalCodeInput.prototype._format=function(){this._el.value=this._el.value.replace(/ /g,"").substring(0,PostalCodeInput.MAX_LENGTH)};var IconSelector=function(e,h){this._iconContainer=e;this._disabledClass=h;this._iconList=[];this._isSet=!1};
IconSelector.prototype.populateList=function(e){if(this._iconContainer&&!this._isSet){this._isSet=!0;var h=document.createDocumentFragment(),m;for(m in e)if(e.hasOwnProperty(m)){var q=document.createElement("span");q.className="icon-provider "+e[m];q.className+=" disabled";h.appendChild(q)}this._iconContainer.appendChild(h);this._iconList=this._getIconList()}};
IconSelector.prototype.highlightIcon=function(e){for(var h=0;h<this._iconList.length;h++){var m=this._iconList[h],q=m.className.split(" "),t=q.indexOf(this._disabledClass);m.getAttribute("data-type")===e?-1<t&&q.splice(t):-1===t&&q.push(this._disabledClass);m.className=q.join(" ")}};
IconSelector.prototype._getIconList=function(){for(var e=[],h=this._iconContainer.getElementsByTagName("span"),m=0;m<h.length;m++){var q=h[m].className.split(" ");-1<q.indexOf("icon-provider")&&(h[m].setAttribute("data-type","undefined"!==typeof q[1]?q[1]:""),e.push(h[m]))}return e};var FieldParser=function(e){this._form=e;this._fieldMap=null};FieldParser.prototype.getFieldMap=function(){this._fieldMap||(this._fieldMap=this._setupFields());return this._fieldMap};
FieldParser.prototype._setupFields=function(){return[].slice.call(this._form.getElementsByTagName("input")).concat([].slice.call(this._form.getElementsByTagName("select"))).reduce(function(e,h){var m=h.hasAttribute("data-encrypted-name")?h.getAttribute("data-encrypted-name"):h.getAttribute("name");e[m]=h;return e},{})};var FormValidator=function(e,h,m){this._cardStore=e;this._fieldMap=h;this._sender=m};
FormValidator.prototype.validateForm=function(){var e=!0,h;for(h in this._fieldMap)if(this._fieldMap.hasOwnProperty(h)){var m=this._fieldMap[h].value,q=null;switch(h){case "number":q=this._cardStore.isValidNumber(m)?null:"invalid_creditcard";break;case "expiryMonth":q=this._isEmptyError(m,"invalid_mm");break;case "expiryYear":q=this._isEmptyError(m,"invalid_yy");break;case "expiryDate":q=this._validateExpiryDate(m);break;case "cvc":q=this._validateCvc(m,this._fieldMap.number?this._fieldMap.number.value:
"");break;case "zip-code":q=this._validateZipCode(m);break;case "zip-code-choices":q=this._validatezipCodeChoices(m)}null===q?m={route:"hideError",data:{errorType:h}}:(e=!1,m={route:"showError",data:{errorType:h,msg:q}});this._sender.send(m)}return e};FormValidator.prototype.removeField=function(e){this._fieldMap.hasOwnProperty(e)&&delete this._fieldMap[e]};FormValidator.prototype._isEmptyError=function(e,h){return""===e?h:null};
FormValidator.prototype._validateCvc=function(e,h){return this._cardStore.isValidCvcForCardNumber(e,h)?null:"invalid_cvc"};FormValidator.prototype._validateExpiryDate=function(e){e=e.replace(/ /g,"");return/^(1[0-2]|0[1-9]|[1-9])\/\d\d$/.test(e)?null:"invalid_expiry_date"};FormValidator.prototype._validateZipCode=function(e){return/(^\w{3,}$)/.test(e.replace(/[ -]+/g,""))?null:"invalid_zipcode"};FormValidator.prototype._validatezipCodeChoices=function(e){return e?null:"invalid_zipcode"};
var Resizer=function(e,h){this._window=e;this._sender=h;this._height=0;this._body=this._window.document.body};Resizer.prototype.sendHeightToParent=function(){this._height=this._getHeight();this._sendMessage()};Resizer.prototype._getHeight=function(){return this._body.clientHeight};Resizer.prototype._sendMessage=function(){this._sender.send({route:"resize",data:{height:this._height}})};
var HoverHandler=function(e,h,m,q){this._elements=e;this._timeout=h;this._window=m;this._sender=q;this._timer=this._currentTarget=null};HoverHandler.prototype.attach=function(){for(var e=0;e<this._elements.length;e++)this._elements[e].addEventListener("mouseover",this._startHover.bind(this)),this._elements[e].addEventListener("touchstart",this._startHover.bind(this)),this._elements[e].addEventListener("mouseleave",this._endHover.bind(this)),this._elements[e].addEventListener("touchend",this._endHover.bind(this))};
HoverHandler.prototype._startHover=function(e){this._currentTarget!==e.target&&(this._currentTarget=e.target,this._timer=this._window.setTimeout(this._messageShow.bind(this),this._timeout))};HoverHandler.prototype._endHover=function(e){null!==this._currentTarget&&(this._currentTarget=null,clearTimeout(this._timer),this._messageHide())};HoverHandler.prototype._messageShow=function(){this._sender.send({route:"showTooltip",data:{key:this._currentTarget.getAttribute("data-lang"),offset:this._getOffset(this._currentTarget)}})};
HoverHandler.prototype._messageHide=function(){this._sender.send({route:"hideTooltip",data:{}})};HoverHandler.prototype._getOffset=function(e){for(var h={w:e.clientWidth,h:e.clientHeight},m=0,q=0;e;)m+=e.offsetLeft,q+=e.offsetTop,e=e.offsetParent;h.x=m;h.y=q;return h};var MsgSender=function(e,h){this._parent=e;this._domainWhitelist=h instanceof Array?h:null;this._broadcastDomain=null};
MsgSender.prototype.send=function(e){if(!this._broadcastDomain)return!1;e=JSON.stringify(e);this._parent.postMessage(e,this._broadcastDomain);return!0};MsgSender.prototype.setBroadcastDomain=function(e){this._domainWhitelist&&0>this._domainWhitelist.indexOf("*")&&0>this._domainWhitelist.indexOf(e)||(this._broadcastDomain=e)};var Translator=function(){this._translations=null;this._isSet=!1};Translator.TRANS_KEY="trans-";Translator.prototype.setTranslations=function(e){this._translations=e};
Translator.prototype.injectTranslations=function(){if(!this._isSet){this._isSet=!0;for(var e in this._translations)if(this._translations.hasOwnProperty(e)){var h=document.getElementById(Translator.TRANS_KEY+e);h&&h.appendChild(document.createTextNode(this._translations[e]))}}};var YearSelect=function(e){this._el=e};YearSelect.YEARS=30;
YearSelect.prototype.create=function(){if(this._el){for(var e=this._el,h=document.createDocumentFragment(),m=(new Date).getFullYear(),q=0;q<YearSelect.YEARS;q++){var t=document.createElement("option");t.setAttribute("value",m+q);t.appendChild(document.createTextNode((m+q).toString().substr(2)));h.appendChild(t)}e.appendChild(h)}};var Submitter=function(e,h,m,q,t,C,I){this._validator=e;this._fieldMap=h;this._cse=m;this._sender=q;this._cardStore=t;this._zipCode=C;this._zipCodeChoices=I};
Submitter.prototype.handlePost=function(e){if(this._validator.validateForm()){var h=this._getData();e=this._cse.encrypt(e,h);h=this._cardStore.getCardBin(h.number);h={success:!0,token:e,bin:h};this._zipCode.disabled&&this._zipCodeChoices.disabled||(h.zipcode=this._zipCode.value||this._zipCodeChoices.value);this._sender.send({route:"proceed",data:h})}};
Submitter.prototype._getData=function(){var e,h;this._fieldMap.expiryDate?(h=this._parseExpiryDate(this._fieldMap.expiryDate.value),e=h[0],h=h[1]):(e=this._fieldMap.expiryMonth.value,h=this._fieldMap.expiryYear.value);return{number:this._fieldMap.number.value,cvc:this._fieldMap.cvc.value,expiryMonth:e,expiryYear:h,generationtime:this._fieldMap.generationtime.value}};
Submitter.prototype._parseExpiryDate=function(e){var h=e.replace(/ /g,"").split("/");e=parseInt(h[0],10).toString();h=Math.floor((new Date).getFullYear()/100)+h[1];return[e,h]};var CssAttacher=function(e,h){this._window=e;this._cssOrigin=h};CssAttacher.FALLBACK_DETECT_DELAY=1E3;CssAttacher.FALLBACK_DETECT_INTERVAL=100;CssAttacher.prototype.addCss=function(e,h){if(e instanceof Array){var m=e.filter(this._validateCssOrigin.bind(this)).map(this._createStyleSheet.bind(this));this._loadStyleSheets(m,h)}};
CssAttacher.prototype._createStyleSheet=function(e){var h=this._window.document.createElement("link");h.type="text/css";h.rel="stylesheet";h.href=e;return h};
CssAttacher.prototype._loadStyleSheets=function(e,h){function m(){C+=1;C===t&&q()}for(var q=function(){var e=!1;return function(){e||(e=!0,h())}}(),t=e.length,C=0,I=this._window.document.getElementsByTagName("head")[0],G=0;G<t;G++)e[G].addEventListener("load",m),I.appendChild(e[G]);this._window.setTimeout(function(){0===C&&this._startFallbackOnloadDetect(e,q)}.bind(this),CssAttacher.FALLBACK_DETECT_DELAY)};
CssAttacher.prototype._startFallbackOnloadDetect=function(e,h){var m=e.map(function(e){return e.href}),q=[].slice.call(this._window.document.styleSheets).filter(function(e){return-1<m.indexOf(e.href)});if(m.length===q.length)return h();this._window.setTimeout(this._startFallbackOnloadDetect.bind(this,e,h),CssAttacher.FALLBACK_DETECT_INTERVAL)};CssAttacher.prototype._validateCssOrigin=function(e){if(!e)return!1;e=this._getDomain(e);return(new RegExp(this._cssOrigin)).test(e)};
CssAttacher.prototype._getDomain=function(e){var h=this._window.document.createElement("a");h.href=e;return["https://",h.hostname].join("")};var DomInteractor=function(e,h){this._documentNode=e;this._validator=h;this._isGenTimeSet=this._isPostalSet=!1};
DomInteractor.prototype.setPostal=function(e){if(!this._isPostalSet){this._isPostalSet=!0;var h=this._documentNode.getElementById("zip-code"),m=this._documentNode.getElementById("zip-code-choices"),q=this._documentNode.getElementById("trans-label_postal_code"),t=this._documentNode.getElementById("trans-label_postal_code_choices");if(e.hasOwnProperty("require")&&e.hasOwnProperty("postal_code"))if(e.require)switch(e.type){case "choices":this._createPostalDropdown(e,m);this._hidePostalCode(h,q,"zip-code");
break;default:h.value=e.postal_code,this._hidePostalCode(m,t,"zip-code-choices")}else this._hidePostalCode(h,q,"zip-code"),this._hidePostalCode(m,t,"zip-code-choices");else this._hidePostalCode(h,q,"zip-code"),this._hidePostalCode(m,t,"zip-code-choices")}};DomInteractor.prototype.setGenTime=function(e){this._isGenTimeSet||(this._isGenTimeSet=!0,this._documentNode.getElementById("generation-time").value=e)};
DomInteractor.prototype._hidePostalCode=function(e,h,m){e.style.display="none";e.disabled=!0;h.style.display="none";this._validator.removeField(m)};DomInteractor.prototype._createPostalDropdown=function(e,h){e.choices.forEach(function(m){var q=this._documentNode.createElement("option");q.value=m.value;q.innerHTML=m.label;q.selected=m.value===e.postal_code;h.appendChild(q)},this)};
var Router=function(e,h,m,q,t,C,I,G,H,E){this._window=e;this._submitter=h;this._validator=m;this._translator=q;this._iconSelector=t;this._resizer=C;this._domInteractor=I;this._cssAttacher=G;this._sender=H;this._listenOrigin=E;var J=this;this._window.addEventListener("message",function(e){J._msgListener(e,!1)},!1)};
Router.prototype._msgListener=function(e){if(this._checkOrigin(e.origin)&&(e=e.data,e=JSON.parse(e),this._validateMessage(e)))switch(e.route){case "setDomain":this._sender.setBroadcastDomain(e.data);this._sender.send({route:"load",data:{}});break;case "submit":this._submitter.handlePost(e.data.provider);break;case "configure":this._cssAttacher.addCss(e.data.css,this._sendDisplayMessage.bind(this));this._translator.setTranslations(e.data.translations);this._translator.injectTranslations();this._iconSelector.populateList(e.data.icons);
this._domInteractor.setPostal(e.data.postal);this._domInteractor.setGenTime(e.data.genTime);break;case "getHeight":this._resizer.sendHeightToParent()}};Router.prototype._sendDisplayMessage=function(){this._sender.send({route:"display",data:{}})};Router.prototype._checkOrigin=function(e){return(new RegExp(this._listenOrigin)).test(e)};Router.prototype._validateMessage=function(e){return e instanceof Object&&e.hasOwnProperty("route")&&e.hasOwnProperty("data")};
(function(){var e=document.getElementById("payment-form"),h=new MsgSender(window.parent,["https://www.spotify.com","https://www-staging.spotify.com","https://www-staging3.spotify.com"]),m=(new FieldParser(e)).getFieldMap(),q=new CardStore,e=new IconSelector(document.getElementById("provider-icons"),"disabled"),t=new FormValidator(q,m,h),C=new Resizer(window,h),I=new CvcInput(m.cvc),G=new CardNumberInput(m.number,q,I,e),H=new PostalCodeInput(m["zip-code"]),E=null;m.expiryDate&&(E=new ExpiryDateInput(m.expiryDate));
var J=new HoverHandler(document.querySelectorAll(".tooltip, [data-tooltip]"),100,window,h),S=new YearSelect(document.getElementById("expiry-year")),T=new DomInteractor(document,t),x=new CssAttacher(window,"(^https://www\\.scdn\\.co$)"),M=new Translator,w={};w.adyen=new AdyenEncrypter(adyen.encrypt,"10001|BD3CE0C63C52704C4A8D9263E227D9A4122862A44300645B8AD5CC6401597BB711C87C962FAED958209F8D6AF9E2D64C330C7C295CB77ABC70C0B1857A54AC84AC9CFDF895A55507A3B47BD940EEAB7B96C2D147D4D96933792B1667DEA36C54F43B8381E64210FB4665B04131292164A1C82E24F7D0E61ADD122DCF648F31D9B6BFC14BB27F6A7975F9604A1A3AC8D940A139E4BFD397522EC9DC7B717A616A4F02DC8FBD4E3A2D9861F3C87B5712D525B899BB7619DD49A359E07A890D5FC1FAA56F23FD6CCD31EDB835DF4338F568B8DEB04698572CCA0960D466F89F72A2A47254583208723DD6FFC7278E347BABB6132124207D27CAF2954A98952C8ADB",
"Spotify User",m.number,m.cvc);w.digitalriver=new DigitalRiverEncrypter(drwp.encrypt,"10001|aa0a38ecae66195a1f90355e36ade9c093131a4de0fbfef90c377d6c879c2db42a6f6226c76162a88cc2adf1c89b759bd89c2e1083044f6c3fae0b3c331962725fbdde037ef242566f7c02e21f24fc09e3f65930e2b4ba5ef09f6eef02d89278d9d38ac10f4af65a32d0c79406eb212358149aa4cc8f1a18772c68983917b2292d62b01d526ceb01c4a28e849ecc51b241f11a830479adc778ded5c64f18f94bb8378f0f45bbd31cc9f791cd1bc612f4d15e3c2b16560e30d0e6a517c41f90558541e6b5cca779ce4e47f07d58926d1c40fdc2e3725772035f8cc9b8703dc11bc705fda493cd9a0dc208f7ad24c9201c1da6d365e0749ce0ece74e132c297b0d",
"spotify","Spotify","User");w=new CSE(w);m=new Submitter(t,m,w,h,q,document.getElementById("zip-code"),document.getElementById("zip-code-choices"));new Router(window,m,t,M,e,C,T,x,h,"(^https://www\\.spotify\\.com$|^https://www-staging\\.spotify\\.com|^https://www-staging3\\.spotify\\.com$)");window.addEventListener("load",function(){S.create();J.attach();I.attach();G.attach();H.attach();E&&E.attach()});h=new MsgSender(window.parent);h.setBroadcastDomain("*");h.send({route:"ping"})})();